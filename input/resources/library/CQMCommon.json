{
  "resourceType": "Library",
  "id": "CQMCommon",
  "extension": [ {
    "url": "http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem",
    "valueReference": {
      "reference": "Device/cqf-tooling"
    }
  } ],
  "url": "http://ecqi.healthit.gov/ecqms/Library/CQMCommon",
  "version": "4.0.000",
  "name": "CQMCommon",
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBDUU1Db21tb24gdmVyc2lvbiAnNC4wLjAwMCcKCnVzaW5nIFFJQ29yZSB2ZXJzaW9uICc2LjAuMCcKCmluY2x1ZGUgRkhJUkhlbHBlcnMgdmVyc2lvbiAnNC40LjAwMCcgY2FsbGVkIEZISVJIZWxwZXJzCmluY2x1ZGUgUUlDb3JlQ29tbW9uIHZlcnNpb24gJzQuMC4wMDAnIGNhbGxlZCBRSUNvcmVDb21tb24KCmNvZGVzeXN0ZW0gRGlhZ25vc2lzUm9sZTogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vZGlhZ25vc2lzLXJvbGUnCmNvZGVzeXN0ZW0gIkRpYWdub3NpcyBUeXBlIjogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vZXgtZGlhZ25vc2lzdHlwZScKY29kZXN5c3RlbSAiUHJvY2VkdXJlIFR5cGUiOiAnaHR0cDovL3Rlcm1pbm9sb2d5LmhsNy5vcmcvQ29kZVN5c3RlbS9leC1wcm9jZWR1cmUtdHlwZScKY29kZXN5c3RlbSAiUHJlc2VudCBPbiBBZG1pc3Npb24gSW5kaWNhdG9ycyI6ICdodHRwczovL3d3dy5jbXMuZ292L01lZGljYXJlL01lZGljYXJlLUZlZS1mb3ItU2VydmljZS1QYXltZW50L0hvc3BpdGFsQWNxQ29uZC9Db2RpbmcnCgp2YWx1ZXNldCAiRW1lcmdlbmN5IERlcGFydG1lbnQgVmlzaXQiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuMTE3LjEuNy4xLjI5MicKdmFsdWVzZXQgIkVuY291bnRlciBJbnBhdGllbnQiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzODgzLjMuNjY2LjUuMzA3Jwp2YWx1ZXNldCAiSW50ZW5zaXZlIENhcmUgVW5pdCI6ICdodHRwOi8vY3RzLm5sbS5uaWguZ292L2ZoaXIvVmFsdWVTZXQvMi4xNi44NDAuMS4xMTM3NjIuMS40LjEwMjkuMjA2Jwp2YWx1ZXNldCAiT2JzZXJ2YXRpb24gU2VydmljZXMiOiAnaHR0cDovL2N0cy5ubG0ubmloLmdvdi9maGlyL1ZhbHVlU2V0LzIuMTYuODQwLjEuMTEzNzYyLjEuNC4xMTExLjE0MycKdmFsdWVzZXQgIk91dHBhdGllbnQgU3VyZ2VyeSBTZXJ2aWNlIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTExMC4zOCcKdmFsdWVzZXQgIlByZXNlbnQgb24gQWRtaXNzaW9uIG9yIENsaW5pY2FsbHkgVW5kZXRlcm1pbmVkIjogJ2h0dHA6Ly9jdHMubmxtLm5paC5nb3YvZmhpci9WYWx1ZVNldC8yLjE2Ljg0MC4xLjExMzc2Mi4xLjQuMTE0Ny4xOTcnCgpjb2RlICJCaWxsaW5nIjogJ2JpbGxpbmcnIGZyb20gRGlhZ25vc2lzUm9sZSBkaXNwbGF5ICdCaWxsaW5nJwpjb2RlICJBZG1pdHRpbmcgRGlhZ25vc2lzIjogJ2FkbWl0dGluZycgZnJvbSAiRGlhZ25vc2lzIFR5cGUiIGRpc3BsYXkgJ0FkbWl0dGluZyBEaWFnbm9zaXMnCmNvZGUgIkNsaW5pY2FsIERpYWdub3NpcyI6ICdjbGluaWNhbCcgZnJvbSAiRGlhZ25vc2lzIFR5cGUiIGRpc3BsYXkgJ0NsaW5pY2FsIERpYWdub3NpcycKY29kZSAiRGlmZmVyZW50aWFsIERpYWdub3NpcyI6ICdkaWZmZXJlbnRpYWwnIGZyb20gIkRpYWdub3NpcyBUeXBlIiBkaXNwbGF5ICdEaWZmZXJlbnRpYWwgRGlhZ25vc2lzJwpjb2RlICJEaXNjaGFyZ2UgRGlhZ25vc2lzIjogJ2Rpc2NoYXJnZScgZnJvbSAiRGlhZ25vc2lzIFR5cGUiIGRpc3BsYXkgJ0Rpc2NoYXJnZSBEaWFnbm9zaXMnCmNvZGUgIkxhYm9yYXRvcnkgRGlhZ25vc2lzIjogJ2xhYm9yYXRvcnknIGZyb20gIkRpYWdub3NpcyBUeXBlIiBkaXNwbGF5ICdMYWJvcmF0b3J5IERpYWdub3NpcycKY29kZSAiTnVyc2luZyBEaWFnbm9zaXMiOiAnbnVyc2luZycgZnJvbSAiRGlhZ25vc2lzIFR5cGUiIGRpc3BsYXkgJ051cnNpbmcgRGlhZ25vc2lzJwpjb2RlICJQcmVuYXRhbCBEaWFnbm9zaXMiOiAncHJlbmF0YWwnIGZyb20gIkRpYWdub3NpcyBUeXBlIiBkaXNwbGF5ICdQcmVuYXRhbCBEaWFnbm9zaXMnCmNvZGUgIlByaW5jaXBhbCBEaWFnbm9zaXMiOiAncHJpbmNpcGFsJyBmcm9tICJEaWFnbm9zaXMgVHlwZSIgZGlzcGxheSAnUHJpbmNpcGFsIERpYWdub3NpcycKY29kZSAiUmFkaW9sb2d5IERpYWdub3NpcyI6ICdyYWRpb2xvZ3knIGZyb20gIkRpYWdub3NpcyBUeXBlIiBkaXNwbGF5ICdSYWRpb2xvZ3kgRGlhZ25vc2lzJwpjb2RlICJSZW1vdGUgRGlhZ25vc2lzIjogJ3JlbW90ZScgZnJvbSAiRGlhZ25vc2lzIFR5cGUiIGRpc3BsYXkgJ1JlbW90ZSBEaWFnbm9zaXMnCmNvZGUgIlJldHJvc3BlY3RpdmUgRGlhZ25vc2lzIjogJ3JldHJvc3BlY3RpdmUnIGZyb20gIkRpYWdub3NpcyBUeXBlIiBkaXNwbGF5ICdSZXRyb3NwZXRpdmUgRGlhZ25vc2lzJwpjb2RlICJTZWxmIERpYWdub3NpcyI6ICdzZWxmJyBmcm9tICJEaWFnbm9zaXMgVHlwZSIgZGlzcGxheSAnU2VsZiBEaWFnbm9zaXMnCmNvZGUgIlByaW1hcnkgcHJvY2VkdXJlIjogJ3ByaW1hcnknIGZyb20gIlByb2NlZHVyZSBUeXBlIiBkaXNwbGF5ICdQcmltYXJ5IHByb2NlZHVyZScKY29kZSAiUE9BLVkiOiAnWScgZnJvbSAiUHJlc2VudCBPbiBBZG1pc3Npb24gSW5kaWNhdG9ycyIgZGlzcGxheSAnUE9BLVknCmNvZGUgIlBPQS1OIjogJ04nIGZyb20gIlByZXNlbnQgT24gQWRtaXNzaW9uIEluZGljYXRvcnMiIGRpc3BsYXkgJ1BPQS1OJwpjb2RlICJQT0EtVyI6ICdXJyBmcm9tICJQcmVzZW50IE9uIEFkbWlzc2lvbiBJbmRpY2F0b3JzIiBkaXNwbGF5ICdQT0EtVycKY29kZSAiUE9BLTEiOiAnMScgZnJvbSAiUHJlc2VudCBPbiBBZG1pc3Npb24gSW5kaWNhdG9ycyIgZGlzcGxheSAnUE9BLTEnCmNvZGUgIlBPQS1VIjogJ1UnIGZyb20gIlByZXNlbnQgT24gQWRtaXNzaW9uIEluZGljYXRvcnMiIGRpc3BsYXkgJ1BPQS1VJwoKcGFyYW1ldGVyICJNZWFzdXJlbWVudCBQZXJpb2QiIEludGVydmFsPERhdGVUaW1lPgoKY29udGV4dCBQYXRpZW50CgpkZWZpbmUgIklucGF0aWVudCBFbmNvdW50ZXIiOgogIFtFbmNvdW50ZXI6ICJFbmNvdW50ZXIgSW5wYXRpZW50Il0gRW5jb3VudGVySW5wYXRpZW50CiAgICB3aGVyZSBFbmNvdW50ZXJJbnBhdGllbnQuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICBhbmQgRW5jb3VudGVySW5wYXRpZW50LnBlcmlvZCBlbmRzIGR1cmluZyBkYXkgb2YgIk1lYXN1cmVtZW50IFBlcmlvZCIKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyBhbiBpbnRlcnZhbCBvZiBkYXRlIHZhbHVlcyBleHRyYWN0ZWQgZnJvbSB0aGUgaW5wdXQgaW50ZXJ2YWwgb2YgZGF0ZS10aW1lIHZhbHVlcwpAY29tbWVudDogVGhpcyBmdW5jdGlvbiByZXR1cm5zIGFuIGludGVydmFsIGNvbnN0cnVjdGVkIHVzaW5nIHRoZSBgZGF0ZSBmcm9tYCBleHRyYWN0b3Igb24gdGhlIHN0YXJ0CmFuZCBlbmQgdmFsdWVzIG9mIHRoZSBpbnB1dCBkYXRlLXRpbWUgaW50ZXJ2YWwuIE5vdGUgdGhhdCB1c2luZyBhIHByZWNpc2lvbiBzcGVjaWZpZXIgc3VjaCBhcyBgZGF5IG9mYAphcyBwYXJ0IG9mIGEgdGltaW5nIHBocmFzZSBpcyBwcmVmZXJyZWQgdG8gY29tbXVuaWNhdGUgaW50ZW50IHRvIHBlcmZvcm0gZGF5LWxldmVsIGNvbXBhcmlzb24sIGFzIHdlbGwKYXMgZm9yIGdlbmVyYWwgcmVhZGFiaWxpdHkuCiovCmRlZmluZSBmdW5jdGlvbiAiVG9EYXRlSW50ZXJ2YWwiKHBlcmlvZCBJbnRlcnZhbDxEYXRlVGltZT4pOgogIEludGVydmFsW2RhdGUgZnJvbSBzdGFydCBvZiBwZXJpb2QsIGRhdGUgZnJvbSBlbmQgb2YgcGVyaW9kXQoKLyoKQGRlc2NyaXB0aW9uOiBDYWxjdWxhdGVzIHRoZSBkaWZmZXJlbmNlIGluIGNhbGVuZGFyIGRheXMgYmV0d2VlbiB0aGUgc3RhcnQgYW5kIGVuZCBvZiB0aGUgZ2l2ZW4gaW50ZXJ2YWwuCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGluIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBsZW5ndGhJbkRheXMoKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJMZW5ndGhJbkRheXMiKFZhbHVlIEludGVydmFsPERhdGVUaW1lPiApOgogIGRpZmZlcmVuY2UgaW4gZGF5cyBiZXR3ZWVuIHN0YXJ0IG9mIFZhbHVlIGFuZCBlbmQgb2YgVmFsdWUKCi8qCkBkZXNjcmlwdGlvbjogQ2FsY3VsYXRlcyB0aGUgZGlmZmVyZW5jZSBpbiBjYWxlbmRhciBkYXlzIGJldHdlZW4gdGhlIHN0YXJ0IGFuZCBlbmQgb2YgdGhlIGdpdmVuIGludGVydmFsLgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGxlbmd0aEluRGF5cyhWYWx1ZSBJbnRlcnZhbDxEYXRlVGltZT4gKToKICBkaWZmZXJlbmNlIGluIGRheXMgYmV0d2VlbiBzdGFydCBvZiBWYWx1ZSBhbmQgZW5kIG9mIFZhbHVlCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIG1vc3QgcmVjZW50IGVtZXJnZW5jeSBkZXBhcnRtZW50IHZpc2l0LCBpZiBhbnksIHRoYXQgb2NjdXJzIDEgaG91ciBvciBsZXNzIHByaW9yIHRvIHRoZSBnaXZlbiBlbmNvdW50ZXIuCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBlZFZpc2l0KClgIGluc3RlYWQuCiovCmRlZmluZSBmdW5jdGlvbiAiRUQgVmlzaXQiKFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICBMYXN0KAogICAgW0VuY291bnRlcjogIkVtZXJnZW5jeSBEZXBhcnRtZW50IFZpc2l0Il0gRURWaXNpdAogICAgICB3aGVyZSBFRFZpc2l0LnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICBhbmQgRURWaXNpdC5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgc3RhcnQgb2YgVGhlRW5jb3VudGVyLnBlcmlvZAogICAgICBzb3J0IGJ5IGVuZCBvZiBwZXJpb2QKICAgICkKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyB0aGUgbW9zdCByZWNlbnQgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQsIGlmIGFueSwgdGhhdCBvY2N1cnMgMSBob3VyIG9yIGxlc3MgcHJpb3IgdG8gdGhlIGdpdmVuIGVuY291bnRlci4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBlZFZpc2l0KFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICBMYXN0KAogICAgW0VuY291bnRlcjogIkVtZXJnZW5jeSBEZXBhcnRtZW50IFZpc2l0Il0gRURWaXNpdAogICAgICB3aGVyZSBFRFZpc2l0LnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICBhbmQgRURWaXNpdC5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgc3RhcnQgb2YgVGhlRW5jb3VudGVyLnBlcmlvZAogICAgICBzb3J0IGJ5IGVuZCBvZiBwZXJpb2QKICAgICkKCi8qCkBkZXNjcmlwdGlvbjogSG9zcGl0YWxpemF0aW9uIHJldHVybnMgdGhlIHRvdGFsIGludGVydmFsIGZvciBhZG1pc3Npb24gdG8gZGlzY2hhcmdlIGZvciB0aGUgZ2l2ZW4gZW5jb3VudGVyLCBvciBmb3IgdGhlIGFkbWlzc2lvbiBvZiBhbnkgaW1tZWRpYXRlbHkgcHJpb3IgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQgdG8gdGhlIGRpc2NoYXJnZSBvZiB0aGUgZ2l2ZW4gZW5jb3VudGVyLgpAZGVwcmVjYXRlZDogVGhpcyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlIGZsdWVudCBmdW5jdGlvbiBgaG9zcGl0YWxpemF0aW9uKClgIGluc3RlYWQuCiovCmRlZmluZSBmdW5jdGlvbiAiSG9zcGl0YWxpemF0aW9uIihUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgKCAiRUQgVmlzaXQiKFRoZUVuY291bnRlcikgKSBYCiAgICByZXR1cm4KICAgICAgICBpZiBYIGlzIG51bGwgdGhlbiBUaGVFbmNvdW50ZXIucGVyaW9kCiAgICAgICAgZWxzZSBJbnRlcnZhbFtzdGFydCBvZiBYLnBlcmlvZCwgZW5kIG9mIFRoZUVuY291bnRlci5wZXJpb2QpCgovKgpAZGVzY3JpcHRpb246IEhvc3BpdGFsaXphdGlvbiByZXR1cm5zIHRoZSB0b3RhbCBpbnRlcnZhbCBmb3IgYWRtaXNzaW9uIHRvIGRpc2NoYXJnZSBmb3IgdGhlIGdpdmVuIGVuY291bnRlciwgb3IgZm9yIHRoZSBhZG1pc3Npb24gb2YgYW55IGltbWVkaWF0ZWx5IHByaW9yIGVtZXJnZW5jeSBkZXBhcnRtZW50IHZpc2l0IHRvIHRoZSBkaXNjaGFyZ2Ugb2YgdGhlIGdpdmVuIGVuY291bnRlci4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBob3NwaXRhbGl6YXRpb24oVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIChUaGVFbmNvdW50ZXIuImVkVmlzaXQiKCkpIFgKICAgIHJldHVybgogICAgICAgIGlmIFggaXMgbnVsbCB0aGVuIFRoZUVuY291bnRlci5wZXJpb2QKICAgICAgICBlbHNlIEludGVydmFsW3N0YXJ0IG9mIFgucGVyaW9kLCBlbmQgb2YgVGhlRW5jb3VudGVyLnBlcmlvZF0KCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyBsaXN0IG9mIGFsbCBsb2NhdGlvbnMgd2l0aGluIGFuIGVuY291bnRlciwgaW5jbHVkaW5nIGxvY2F0aW9ucyBmb3IgaW1tZWRpYXRlbHkgcHJpb3IgRUQgdmlzaXQuCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBob3NwaXRhbGl6YXRpb25Mb2NhdGlvbnMoKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJIb3NwaXRhbGl6YXRpb24gTG9jYXRpb25zIihUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgKCAiRUQgVmlzaXQiKFRoZUVuY291bnRlcikgKSBFREVuY291bnRlcgogICAgcmV0dXJuCiAgICAgICAgaWYgRURFbmNvdW50ZXIgaXMgbnVsbCB0aGVuIFRoZUVuY291bnRlci5sb2NhdGlvbgogICAgICAgIGVsc2UgZmxhdHRlbiB7IEVERW5jb3VudGVyLmxvY2F0aW9uLCBUaGVFbmNvdW50ZXIubG9jYXRpb24gfQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIGxpc3Qgb2YgYWxsIGxvY2F0aW9ucyB3aXRoaW4gYW4gZW5jb3VudGVyLCBpbmNsdWRpbmcgbG9jYXRpb25zIGZvciBpbW1lZGlhdGVseSBwcmlvciBFRCB2aXNpdC4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBob3NwaXRhbGl6YXRpb25Mb2NhdGlvbnMoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogICggVGhlRW5jb3VudGVyLiJlZFZpc2l0IigpKSBFREVuY291bnRlcgogICAgcmV0dXJuCiAgICAgICAgaWYgRURFbmNvdW50ZXIgaXMgbnVsbCB0aGVuIFRoZUVuY291bnRlci5sb2NhdGlvbgogICAgICAgIGVsc2UgZmxhdHRlbiB7IEVERW5jb3VudGVyLmxvY2F0aW9uLCBUaGVFbmNvdW50ZXIubG9jYXRpb24gfQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBsZW5ndGggb2Ygc3RheSBpbiBkYXlzIChpLmUuIHRoZSBudW1iZXIgb2YgZGF5cyBiZXR3ZWVuIGFkbWlzc2lvbiBhbmQgZGlzY2hhcmdlKSBmb3IgdGhlIGdpdmVuIGVuY291bnRlciwgb3IgZnJvbSB0aGUgYWRtaXNzaW9uIG9mIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdCB0byB0aGUgZGlzY2hhcmdlIG9mIHRoZSBlbmNvdW50ZXIKQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGhvc3BpdGFsaXphdGlvbkxlbmd0aE9mU3RheSgpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIkhvc3BpdGFsaXphdGlvbiBMZW5ndGggb2YgU3RheSIoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIExlbmd0aEluRGF5cygiSG9zcGl0YWxpemF0aW9uIihUaGVFbmNvdW50ZXIpKQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBsZW5ndGggb2Ygc3RheSBpbiBkYXlzIChpLmUuIHRoZSBudW1iZXIgb2YgZGF5cyBiZXR3ZWVuIGFkbWlzc2lvbiBhbmQgZGlzY2hhcmdlKSBmb3IgdGhlIGdpdmVuIGVuY291bnRlciwgb3IgZnJvbSB0aGUgYWRtaXNzaW9uIG9mIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdCB0byB0aGUgZGlzY2hhcmdlIG9mIHRoZSBlbmNvdW50ZXIKKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBob3NwaXRhbGl6YXRpb25MZW5ndGhPZlN0YXkoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogICBUaGVFbmNvdW50ZXIuImhvc3BpdGFsaXphdGlvbiIoKS4ibGVuZ3RoSW5EYXlzIigpCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgYWRtaXNzaW9uIHRpbWUgZm9yIGFuIGVuY291bnRlciBvciBmb3IgaW1tZWRpYXRlbHkgcHJpb3IgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQuCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBob3NwaXRhbEFkbWlzc2lvblRpbWUoKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJIb3NwaXRhbCBBZG1pc3Npb24gVGltZSIoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIHN0YXJ0IG9mICJIb3NwaXRhbGl6YXRpb24iKFRoZUVuY291bnRlcikKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyBhZG1pc3Npb24gdGltZSBmb3IgYW4gZW5jb3VudGVyIG9yIGZvciBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdC4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBob3NwaXRhbEFkbWlzc2lvblRpbWUoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIHN0YXJ0IG9mIChUaGVFbmNvdW50ZXIuImhvc3BpdGFsaXphdGlvbiIoKSkKCi8qCkBkZXNjcmlwdGlvbjogSG9zcGl0YWwgRGlzY2hhcmdlIFRpbWUgcmV0dXJucyB0aGUgZGlzY2hhcmdlIHRpbWUgZm9yIGFuIGVuY291bnRlcgpAZGVwcmVjYXRlZDogVGhpcyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlIGZsdWVudCBmdW5jdGlvbiBgaG9zcGl0YWxEaXNjaGFyZ2VUaW1lKClgIGluc3RlYWQuCiovCmRlZmluZSBmdW5jdGlvbiAiSG9zcGl0YWwgRGlzY2hhcmdlIFRpbWUiKFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICBlbmQgb2YgVGhlRW5jb3VudGVyLnBlcmlvZAoKLyoKQGRlc2NyaXB0aW9uOiBIb3NwaXRhbCBEaXNjaGFyZ2UgVGltZSByZXR1cm5zIHRoZSBkaXNjaGFyZ2UgdGltZSBmb3IgYW4gZW5jb3VudGVyCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gaG9zcGl0YWxEaXNjaGFyZ2VUaW1lKFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICBlbmQgb2YgVGhlRW5jb3VudGVyLnBlcmlvZAoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIGVhcmxpZXN0IGFycml2YWwgdGltZSBmb3IgYW4gZW5jb3VudGVyIGluY2x1ZGluZyBhbnkgcHJpb3IgRUQgdmlzaXQuCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBob3NwaXRhbEFycml2YWxUaW1lKClgIGluc3RlYWQuCiovCmRlZmluZSBmdW5jdGlvbiAiSG9zcGl0YWwgQXJyaXZhbCBUaW1lIihUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgc3RhcnQgb2YgRmlyc3QoCiAgCSAgICAoIkhvc3BpdGFsaXphdGlvbiBMb2NhdGlvbnMiKFRoZUVuY291bnRlcikgKSBIb3NwaXRhbExvY2F0aW9uCiAgCQkJc29ydCBieSBzdGFydCBvZiBwZXJpb2QKICAJKS5wZXJpb2QKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyBlYXJsaWVzdCBhcnJpdmFsIHRpbWUgZm9yIGFuIGVuY291bnRlciBpbmNsdWRpbmcgYW55IHByaW9yIEVEIHZpc2l0LgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGhvc3BpdGFsQXJyaXZhbFRpbWUoVGhlRW5jb3VudGVyIEVuY291bnRlciApOgogIHN0YXJ0IG9mIEZpcnN0KAogIAkgICAgKFRoZUVuY291bnRlci4iaG9zcGl0YWxpemF0aW9uTG9jYXRpb25zIigpKSBIb3NwaXRhbExvY2F0aW9uCiAgCQkJc29ydCBieSBzdGFydCBvZiBwZXJpb2QKICAJKS5wZXJpb2QKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyB0aGUgbGF0ZXN0IGRlcGFydHVyZSB0aW1lIGZvciBlbmNvdW50ZXIgaW5jbHVkaW5nIGFueSBwcmlvciBFRCB2aXNpdC4KQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGhvc3BpdGFsRGVwYXJ0dXJlVGltZSgpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIkhvc3BpdGFsIERlcGFydHVyZSBUaW1lIihUaGVFbmNvdW50ZXIgRW5jb3VudGVyKToKCWVuZCBvZiBMYXN0KAoJICAgICggIkhvc3BpdGFsaXphdGlvbiBMb2NhdGlvbnMiKFRoZUVuY291bnRlcikgKSBIb3NwaXRhbExvY2F0aW9uCgkJCXNvcnQgYnkgc3RhcnQgb2YgcGVyaW9kCgkpLnBlcmlvZAoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBsYXRlc3QgZGVwYXJ0dXJlIHRpbWUgZm9yIGVuY291bnRlciBpbmNsdWRpbmcgYW55IHByaW9yIEVEIHZpc2l0LgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGhvc3BpdGFsRGVwYXJ0dXJlVGltZShUaGVFbmNvdW50ZXIgRW5jb3VudGVyKToKCWVuZCBvZiBMYXN0KAoJICAgIChUaGVFbmNvdW50ZXIuImhvc3BpdGFsaXphdGlvbkxvY2F0aW9ucyIoKSkgSG9zcGl0YWxMb2NhdGlvbgoJCQlzb3J0IGJ5IHN0YXJ0IG9mIHBlcmlvZAoJKS5wZXJpb2QKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyB0aGUgZW1lcmdlbmN5IGRlcGFydG1lbnQgYXJyaXZhbCB0aW1lIGZvciB0aGUgZW5jb3VudGVyLgpAZGVwcmVjYXRlZC4gVGhpcyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlIGZsdWVudCBmdW5jdGlvbiBgZW1lcmdlbmN5RGVwYXJ0bWVudEFycml2YWxUaW1lKClgIGluc3RlYWQuCiovCmRlZmluZSBmdW5jdGlvbiAiRW1lcmdlbmN5IERlcGFydG1lbnQgQXJyaXZhbCBUaW1lIihUaGVFbmNvdW50ZXIgRW5jb3VudGVyKToKCXN0YXJ0IG9mICgKCSAgICBzaW5nbGV0b24gZnJvbSAoCgkgICAgICAgICggIkhvc3BpdGFsaXphdGlvbiBMb2NhdGlvbnMiKFRoZUVuY291bnRlcikgKSBIb3NwaXRhbExvY2F0aW9uCgkJCQl3aGVyZSBHZXRMb2NhdGlvbihIb3NwaXRhbExvY2F0aW9uLmxvY2F0aW9uKS50eXBlIGluICJFbWVyZ2VuY3kgRGVwYXJ0bWVudCBWaXNpdCIKCQkpCgkpLnBlcmlvZAoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBlbWVyZ2VuY3kgZGVwYXJ0bWVudCBhcnJpdmFsIHRpbWUgZm9yIHRoZSBlbmNvdW50ZXIuCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gZW1lcmdlbmN5RGVwYXJ0bWVudEFycml2YWxUaW1lKFRoZUVuY291bnRlciBFbmNvdW50ZXIpOgoJc3RhcnQgb2YgKAoJICAgIHNpbmdsZXRvbiBmcm9tICgKCSAgICAgICAgKCAoVGhlRW5jb3VudGVyLiJob3NwaXRhbGl6YXRpb25Mb2NhdGlvbnMiKCkpICkgSG9zcGl0YWxMb2NhdGlvbgoJCQkJd2hlcmUgR2V0TG9jYXRpb24oSG9zcGl0YWxMb2NhdGlvbi5sb2NhdGlvbikudHlwZSBpbiAiRW1lcmdlbmN5IERlcGFydG1lbnQgVmlzaXQiCgkJKQoJKS5wZXJpb2QKCi8qCkBkZXNjcmlwdGlvbjogSG9zcGl0YWxpemF0aW9uIHdpdGggT2JzZXJ2YXRpb24gYW5kIE91dHBhdGllbnQgU3VyZ2VyeSBTZXJ2aWNlIHJldHVybnMgdGhlIHRvdGFsIGludGVydmFsIGZyb20gdGhlIHN0YXJ0IG9mIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdCwgb3V0cGF0aWVudCBzdXJnZXJ5IHZpc2l0IG9yIG9ic2VydmF0aW9uIHZpc2l0IHRvIHRoZSBkaXNjaGFyZ2Ugb2YgdGhlIGdpdmVuIGVuY291bnRlci4KQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbkFuZE91dHBhdGllbnRTdXJnZXJ5U2VydmljZSgpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIkhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbkFuZE91dHBhdGllbnRTdXJnZXJ5U2VydmljZSIoVGhlRW5jb3VudGVyICJFbmNvdW50ZXIiICk6CiAgVGhlRW5jb3VudGVyIFZpc2l0CgkgIGxldCBPYnNWaXNpdDogTGFzdChbRW5jb3VudGVyOiAiT2JzZXJ2YXRpb24gU2VydmljZXMiXSBMYXN0T2JzCgkJICAJd2hlcmUgTGFzdE9icy5zdGF0dXMgPSAnZmluaXNoZWQnCiAgICAgICAgICBhbmQgTGFzdE9icy5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgc3RhcnQgb2YgVmlzaXQucGVyaW9kCgkJCSAgc29ydCBieQllbmQgb2YgcGVyaW9kCiAgICAJKSwKICAgIAlWaXNpdFN0YXJ0OiBDb2FsZXNjZShzdGFydCBvZiBPYnNWaXNpdC5wZXJpb2QsIHN0YXJ0IG9mIFZpc2l0LnBlcmlvZCksCiAgICAJRURWaXNpdDogTGFzdChbRW5jb3VudGVyOiAiRW1lcmdlbmN5IERlcGFydG1lbnQgVmlzaXQiXSBMYXN0RUQKCQkJICB3aGVyZSBMYXN0RUQuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgICAgYW5kIExhc3RFRC5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgVmlzaXRTdGFydAoJCQkgIHNvcnQgYnkJZW5kIG9mIHBlcmlvZAogICAgCSksCiAgICAJVmlzaXRTdGFydFdpdGhFRDogQ29hbGVzY2Uoc3RhcnQgb2YgRURWaXNpdC5wZXJpb2QsIFZpc2l0U3RhcnQpLAogICAgCU91dHBhdGllbnRTdXJnZXJ5VmlzaXQ6IExhc3QoW0VuY291bnRlcjogIk91dHBhdGllbnQgU3VyZ2VyeSBTZXJ2aWNlIl0gTGFzdFN1cmdlcnlPUAoJCQkgIHdoZXJlIExhc3RTdXJnZXJ5T1AucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFZpc2l0U3RhcnRXaXRoRUQKCQkJICBzb3J0IGJ5CWVuZCBvZiBwZXJpb2QKICAgIAkpCiAgCXJldHVybiBJbnRlcnZhbFtDb2FsZXNjZShzdGFydCBvZiBPdXRwYXRpZW50U3VyZ2VyeVZpc2l0LnBlcmlvZCwgVmlzaXRTdGFydFdpdGhFRCksIGVuZCBvZiBWaXNpdC5wZXJpb2RdCgovKgpAZGVzY3JpcHRpb246IEhvc3BpdGFsaXphdGlvbiB3aXRoIE9ic2VydmF0aW9uIGFuZCBPdXRwYXRpZW50IFN1cmdlcnkgU2VydmljZSByZXR1cm5zIHRoZSB0b3RhbCBpbnRlcnZhbCBmcm9tIHRoZSBzdGFydCBvZiBhbnkgaW1tZWRpYXRlbHkgcHJpb3IgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQsIG91dHBhdGllbnQgc3VyZ2VyeSB2aXNpdCBvciBvYnNlcnZhdGlvbiB2aXNpdCB0byB0aGUgZGlzY2hhcmdlIG9mIHRoZSBnaXZlbiBlbmNvdW50ZXIuCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gaG9zcGl0YWxpemF0aW9uV2l0aE9ic2VydmF0aW9uQW5kT3V0cGF0aWVudFN1cmdlcnlTZXJ2aWNlKFRoZUVuY291bnRlciAiRW5jb3VudGVyIiApOgogIFRoZUVuY291bnRlciBWaXNpdAoJICBsZXQgT2JzVmlzaXQ6IExhc3QoW0VuY291bnRlcjogIk9ic2VydmF0aW9uIFNlcnZpY2VzIl0gTGFzdE9icwoJCSAgCXdoZXJlIExhc3RPYnMuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgICAgYW5kIExhc3RPYnMucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIHN0YXJ0IG9mIFZpc2l0LnBlcmlvZAoJCQkgIHNvcnQgYnkJZW5kIG9mIHBlcmlvZAogICAgCSksCiAgICAJVmlzaXRTdGFydDogQ29hbGVzY2Uoc3RhcnQgb2YgT2JzVmlzaXQucGVyaW9kLCBzdGFydCBvZiBWaXNpdC5wZXJpb2QpLAogICAgCUVEVmlzaXQ6IExhc3QoW0VuY291bnRlcjogIkVtZXJnZW5jeSBEZXBhcnRtZW50IFZpc2l0Il0gTGFzdEVECgkJCSAgd2hlcmUgTGFzdEVELnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICAgIGFuZCBMYXN0RUQucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFZpc2l0U3RhcnQKCQkJICBzb3J0IGJ5CWVuZCBvZiBwZXJpb2QKICAgIAkpLAogICAgCVZpc2l0U3RhcnRXaXRoRUQ6IENvYWxlc2NlKHN0YXJ0IG9mIEVEVmlzaXQucGVyaW9kLCBWaXNpdFN0YXJ0KSwKICAgIAlPdXRwYXRpZW50U3VyZ2VyeVZpc2l0OiBMYXN0KFtFbmNvdW50ZXI6ICJPdXRwYXRpZW50IFN1cmdlcnkgU2VydmljZSJdIExhc3RTdXJnZXJ5T1AKCQkJICB3aGVyZSBMYXN0U3VyZ2VyeU9QLnBlcmlvZCBlbmRzIDEgaG91ciBvciBsZXNzIG9uIG9yIGJlZm9yZSBWaXNpdFN0YXJ0V2l0aEVECgkJCSAgc29ydCBieQllbmQgb2YgcGVyaW9kCiAgICAJKQogIAlyZXR1cm4gSW50ZXJ2YWxbQ29hbGVzY2Uoc3RhcnQgb2YgT3V0cGF0aWVudFN1cmdlcnlWaXNpdC5wZXJpb2QsIFZpc2l0U3RhcnRXaXRoRUQpLCBlbmQgb2YgVmlzaXQucGVyaW9kXQoKLyoKQGRlc2NyaXB0aW9uOiBIb3NwaXRhbGl6YXRpb24gd2l0aCBPYnNlcnZhdGlvbiByZXR1cm5zIHRoZSB0b3RhbCBpbnRlcnZhbCBmcm9tIHRoZSBzdGFydCBvZiBhbnkgaW1tZWRpYXRlbHkgcHJpb3IgZW1lcmdlbmN5IGRlcGFydG1lbnQgdmlzaXQgdGhyb3VnaCB0aGUgb2JzZXJ2YXRpb24gdmlzaXQgdG8gdGhlIGRpc2NoYXJnZSBvZiB0aGUgZ2l2ZW4gZW5jb3VudGVyCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBob3NwaXRhbGl6YXRpb25XaXRoT2JzZXJ2YXRpb24oKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJIb3NwaXRhbGl6YXRpb25XaXRoT2JzZXJ2YXRpb24iKFRoZUVuY291bnRlciBFbmNvdW50ZXIgKToKICBUaGVFbmNvdW50ZXIgVmlzaXQKICAJCWxldCBPYnNWaXNpdDogTGFzdChbRW5jb3VudGVyOiAiT2JzZXJ2YXRpb24gU2VydmljZXMiXSBMYXN0T2JzCiAgCQkJCXdoZXJlIExhc3RPYnMuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgICAgICBhbmQgTGFzdE9icy5wZXJpb2QgZW5kcyAxIGhvdXIgb3IgbGVzcyBvbiBvciBiZWZvcmUgc3RhcnQgb2YgVmlzaXQucGVyaW9kCiAgCQkJCXNvcnQgYnkgZW5kIG9mIHBlcmlvZAogIAkJCSksCiAgCQkJVmlzaXRTdGFydDogQ29hbGVzY2Uoc3RhcnQgb2YgT2JzVmlzaXQucGVyaW9kLCBzdGFydCBvZiBWaXNpdC5wZXJpb2QpLAogIAkJCUVEVmlzaXQ6IExhc3QoW0VuY291bnRlcjogIkVtZXJnZW5jeSBEZXBhcnRtZW50IFZpc2l0Il0gTGFzdEVECiAgCQkJCXdoZXJlIExhc3RFRC5zdGF0dXMgPSAnZmluaXNoZWQnCiAgICAgICAgICAgIGFuZCBMYXN0RUQucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIFZpc2l0U3RhcnQKICAJCQkJc29ydCBieSBlbmQgb2YgcGVyaW9kCiAgCQkJKQogIAkJcmV0dXJuIEludGVydmFsW0NvYWxlc2NlKHN0YXJ0IG9mIEVEVmlzaXQucGVyaW9kLCBWaXNpdFN0YXJ0KSwgZW5kIG9mIFZpc2l0LnBlcmlvZF0KCi8qCkBkZXNjcmlwdGlvbjogSG9zcGl0YWxpemF0aW9uIHdpdGggT2JzZXJ2YXRpb24gcmV0dXJucyB0aGUgdG90YWwgaW50ZXJ2YWwgZnJvbSB0aGUgc3RhcnQgb2YgYW55IGltbWVkaWF0ZWx5IHByaW9yIGVtZXJnZW5jeSBkZXBhcnRtZW50IHZpc2l0IHRocm91Z2ggdGhlIG9ic2VydmF0aW9uIHZpc2l0IHRvIHRoZSBkaXNjaGFyZ2Ugb2YgdGhlIGdpdmVuIGVuY291bnRlcgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbihUaGVFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgVGhlRW5jb3VudGVyIFZpc2l0CiAgCQlsZXQgT2JzVmlzaXQ6IExhc3QoW0VuY291bnRlcjogIk9ic2VydmF0aW9uIFNlcnZpY2VzIl0gTGFzdE9icwogIAkJCQl3aGVyZSBMYXN0T2JzLnN0YXR1cyA9ICdmaW5pc2hlZCcKICAgICAgICAgICAgYW5kIExhc3RPYnMucGVyaW9kIGVuZHMgMSBob3VyIG9yIGxlc3Mgb24gb3IgYmVmb3JlIHN0YXJ0IG9mIFZpc2l0LnBlcmlvZAogIAkJCQlzb3J0IGJ5IGVuZCBvZiBwZXJpb2QKICAJCQkpLAogIAkJCVZpc2l0U3RhcnQ6IENvYWxlc2NlKHN0YXJ0IG9mIE9ic1Zpc2l0LnBlcmlvZCwgc3RhcnQgb2YgVmlzaXQucGVyaW9kKSwKICAJCQlFRFZpc2l0OiBMYXN0KFtFbmNvdW50ZXI6ICJFbWVyZ2VuY3kgRGVwYXJ0bWVudCBWaXNpdCJdIExhc3RFRAogIAkJCQl3aGVyZSBMYXN0RUQuc3RhdHVzID0gJ2ZpbmlzaGVkJwogICAgICAgICAgICBhbmQgTGFzdEVELnBlcmlvZCBlbmRzIDEgaG91ciBvciBsZXNzIG9uIG9yIGJlZm9yZSBWaXNpdFN0YXJ0CiAgCQkJCXNvcnQgYnkgZW5kIG9mIHBlcmlvZAogIAkJCSkKICAJCXJldHVybiBJbnRlcnZhbFtDb2FsZXNjZShzdGFydCBvZiBFRFZpc2l0LnBlcmlvZCwgVmlzaXRTdGFydCksIGVuZCBvZiBWaXNpdC5wZXJpb2RdCgovKgpAZGVzY3JpcHRpb246IEhvc3BpdGFsaXphdGlvbiB3aXRoIE9ic2VydmF0aW9uIExlbmd0aCBvZiBTdGF5IHJldHVybnMgdGhlIGxlbmd0aCBpbiBkYXlzIGZyb20gdGhlIHN0YXJ0IG9mIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdCB0aHJvdWdoIHRoZSBvYnNlcnZhdGlvbiB2aXNpdCB0byB0aGUgZGlzY2hhcmdlIG9mIHRoZSBnaXZlbiBlbmNvdW50ZXIKQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbkxlbmd0aG9mU3RheSgpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIkhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbkxlbmd0aG9mU3RheSIoVGhlRW5jb3VudGVyICJFbmNvdW50ZXIiICk6CiAgIkxlbmd0aEluRGF5cyIoIkhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbiIoVGhlRW5jb3VudGVyKSkKCi8qCkBkZXNjcmlwdGlvbjogSG9zcGl0YWxpemF0aW9uIHdpdGggT2JzZXJ2YXRpb24gTGVuZ3RoIG9mIFN0YXkgcmV0dXJucyB0aGUgbGVuZ3RoIGluIGRheXMgZnJvbSB0aGUgc3RhcnQgb2YgYW55IGltbWVkaWF0ZWx5IHByaW9yIGVtZXJnZW5jeSBkZXBhcnRtZW50IHZpc2l0IHRocm91Z2ggdGhlIG9ic2VydmF0aW9uIHZpc2l0IHRvIHRoZSBkaXNjaGFyZ2Ugb2YgdGhlIGdpdmVuIGVuY291bnRlcgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIGhvc3BpdGFsaXphdGlvbldpdGhPYnNlcnZhdGlvbkxlbmd0aG9mU3RheShUaGVFbmNvdW50ZXIgIkVuY291bnRlciIgKToKICAoKFRoZUVuY291bnRlci4iaG9zcGl0YWxpemF0aW9uV2l0aE9ic2VydmF0aW9uIigpLiJsZW5ndGhJbkRheXMiKCkpKQoKLyoKQGRlc2NyaXB0aW9uOiBGaXJzdCBJbnBhdGllbnQgSW50ZW5zaXZlIENhcmUgVW5pdCByZXR1cm5zIHRoZSBmaXJzdCBpbnRlbnNpdmUgY2FyZSB1bml0IGZvciB0aGUgZ2l2ZW4gZW5jb3VudGVyLCB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdC4KQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGZpcnN0SW5wYXRpZW50SW50ZW5zaXZlQ2FyZVVuaXQoKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJGaXJzdElucGF0aWVudEludGVuc2l2ZUNhcmVVbml0IihFbmNvdW50ZXIgRW5jb3VudGVyICk6CiAgRmlyc3QoKEVuY291bnRlci5sb2NhdGlvbilIb3NwaXRhbExvY2F0aW9uCiAgCQkJd2hlcmUgR2V0TG9jYXRpb24oSG9zcGl0YWxMb2NhdGlvbi5sb2NhdGlvbikudHlwZSBpbiAiSW50ZW5zaXZlIENhcmUgVW5pdCIKICAJCQkJYW5kIEhvc3BpdGFsTG9jYXRpb24ucGVyaW9kIGR1cmluZyBFbmNvdW50ZXIucGVyaW9kCiAgCQkJc29ydCBieSBzdGFydCBvZiBwZXJpb2QKICAJKQoKLyoKQGRlc2NyaXB0aW9uOiBGaXJzdCBJbnBhdGllbnQgSW50ZW5zaXZlIENhcmUgVW5pdCByZXR1cm5zIHRoZSBmaXJzdCBpbnRlbnNpdmUgY2FyZSB1bml0IGZvciB0aGUgZ2l2ZW4gZW5jb3VudGVyLCB3aXRob3V0IGNvbnNpZGVyaW5nIGFueSBpbW1lZGlhdGVseSBwcmlvciBlbWVyZ2VuY3kgZGVwYXJ0bWVudCB2aXNpdC4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBmaXJzdElucGF0aWVudEludGVuc2l2ZUNhcmVVbml0KEVuY291bnRlciBFbmNvdW50ZXIgKToKICBGaXJzdCgoRW5jb3VudGVyLmxvY2F0aW9uKUhvc3BpdGFsTG9jYXRpb24KICAJCQl3aGVyZSBHZXRMb2NhdGlvbihIb3NwaXRhbExvY2F0aW9uLmxvY2F0aW9uKS50eXBlIGluICJJbnRlbnNpdmUgQ2FyZSBVbml0IgogIAkJCQlhbmQgSG9zcGl0YWxMb2NhdGlvbi5wZXJpb2QgZHVyaW5nIEVuY291bnRlci5wZXJpb2QKICAJCQlzb3J0IGJ5IHN0YXJ0IG9mIHBlcmlvZAogIAkpCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIENvbmRpdGlvbiByZXNvdXJjZSByZWZlcmVuY2VkIGJ5IHRoZSBgZGlhZ25vc2lzLmNvbmRpdGlvbmAgZWxlbWVudCBvZiB0aGUgRW5jb3VudGVyCkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBlbmNvdW50ZXJEaWFnbm9zaXMoKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJFbmNvdW50ZXJEaWFnbm9zaXMiKEVuY291bnRlciBFbmNvdW50ZXIgKToKICBFbmNvdW50ZXIuZGlhZ25vc2lzIEQKCXJldHVybiBzaW5nbGV0b24gZnJvbSAoKFtDb25kaXRpb25FbmNvdW50ZXJEaWFnbm9zaXNdIHVuaW9uIFtDb25kaXRpb25Qcm9ibGVtc0hlYWx0aENvbmNlcm5zXSkgQyB3aGVyZSBELmNvbmRpdGlvbi5yZWZlcmVuY2VzKEMuaWQpKQoKLyogIApAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIENvbmRpdGlvbiByZXNvdXJjZXMgcmVmZXJlbmNlZCBieSB0aGUgZGlhZ25vc2lzIGVsZW1lbnQgb2YgdGhlIEVuY291bnRlciAgCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gZW5jb3VudGVyRGlhZ25vc2lzKEVuY291bnRlciBFbmNvdW50ZXIgKToKICBFbmNvdW50ZXIucmVhc29uUmVmZXJlbmNlIEQKICAgIHJldHVybiBzaW5nbGV0b24gZnJvbSAoKFtDb25kaXRpb25FbmNvdW50ZXJEaWFnbm9zaXNdIHVuaW9uIFtDb25kaXRpb25Qcm9ibGVtc0hlYWx0aENvbmNlcm5zXSkgQyB3aGVyZSBELnJlZmVyZW5jZXMoQy5pZCkpCgoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBDb25kaXRpb24gcmVzb3VyY2UgZm9yIHRoZSBnaXZlbiByZWZlcmVuY2UKQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYGdldENvbmRpdGlvbigpYCBpbnN0ZWFkCiovCmRlZmluZSBmdW5jdGlvbiAiR2V0Q29uZGl0aW9uIihyZWZlcmVuY2UgUmVmZXJlbmNlKToKICBzaW5nbGV0b24gZnJvbSAoKFtDb25kaXRpb25FbmNvdW50ZXJEaWFnbm9zaXNdIHVuaW9uIFtDb25kaXRpb25Qcm9ibGVtc0hlYWx0aENvbmNlcm5zXSkgQyB3aGVyZSByZWZlcmVuY2UucmVmZXJlbmNlcyhDLmlkKSkKCi8qCkBkZXNjcmlwdGlvbjogUmV0dXJucyB0aGUgQ29uZGl0aW9uIHJlc291cmNlIGZvciB0aGUgZ2l2ZW4gcmVmZXJlbmNlCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gZ2V0Q29uZGl0aW9uKHJlZmVyZW5jZSBSZWZlcmVuY2UpOgogIHNpbmdsZXRvbiBmcm9tICgoW0NvbmRpdGlvbkVuY291bnRlckRpYWdub3Npc10gdW5pb24gW0NvbmRpdGlvblByb2JsZW1zSGVhbHRoQ29uY2VybnNdKSBDIHdoZXJlIHJlZmVyZW5jZS5yZWZlcmVuY2VzKEMuaWQpKQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBjb25kaXRpb24gdGhhdCBpcyBzcGVjaWZpZWQgYXMgdGhlIHByaW5jaXBhbCBkaWFnbm9zaXMgZm9yIHRoZSBlbmNvdW50ZXIKQGRlcHJlY2F0ZWQ6IFRoaXMgZnVuY3Rpb24gaXMgZGVwcmVjYXRlZC4gVXNlIHRoZSBmbHVlbnQgZnVuY3Rpb24gYHByaW5jaXBhbERpYWdub3NpcygpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIlByaW5jaXBhbERpYWdub3NpcyIoRW5jb3VudGVyIEVuY291bnRlcik6CglzaW5nbGV0b24gZnJvbSAoCgkoRW5jb3VudGVyLmRpYWdub3NpcyBEIHdoZXJlIEQucmFuayA9IDEgYW5kIEQudXNlIH4gIkJpbGxpbmciKSBQRAogICAgICByZXR1cm4gc2luZ2xldG9uIGZyb20gKChbQ29uZGl0aW9uRW5jb3VudGVyRGlhZ25vc2lzXSB1bmlvbiBbQ29uZGl0aW9uUHJvYmxlbXNIZWFsdGhDb25jZXJuc10pIEMgd2hlcmUgUEQuY29uZGl0aW9uLnJlZmVyZW5jZXMoQy5pZCkpCgkpCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIGNvbmRpdGlvbiB0aGF0IGlzIHNwZWNpZmllZCBhcyB0aGUgcHJpbmNpcGFsIGRpYWdub3NpcyBmb3IgdGhlIGVuY291bnRlcgpAZGVwcmVjYXRlZDogVGhpcyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlIGNsYWltRGlhZ25vc2lzIGZ1bmN0aW9uIGZvciBwcmluY2lwYWwgZGlhZ25vc2lzIGFuZCBwcmVzZW50IG9uIGFkbWlzc2lvbiB1c2UgY2FzZXMuIFNlZQpbQ2xhaW1EaWFnbm9zZXNdKGh0dHBzOi8vZ2l0aHViLmNvbS9jcWZyYW1ld29yay9DUUwtRm9ybWF0dGluZy1hbmQtVXNhZ2UtV2lraS9ibG9iL21hc3Rlci9Tb3VyY2UvQ29va2luZyUyMFdpdGglMjBDUUwvODgvQ2xhaW1EaWFnbm9zZXMubWQpIApkaXNjdXNzaW9uIGZvciBtb3JlIGluZm9ybWF0aW9uLgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIHByaW5jaXBhbERpYWdub3NpcyhlbmNvdW50ZXIgRW5jb3VudGVyKToKICBlbmNvdW50ZXIgRTEKCWxldCAKCSAgUEQ6IEUxLmNsYWltRGlhZ25vc2lzKCkgd2hlcmUgUEQudHlwZS5pbmNsdWRlc0NvZGUoIlByaW5jaXBhbCBEaWFnbm9zaXMiKQoJcmV0dXJuICgoW0NvbmRpdGlvbkVuY291bnRlckRpYWdub3Npc10gdW5pb24gW0NvbmRpdGlvblByb2JsZW1zSGVhbHRoQ29uY2VybnNdKSBDIHdoZXJlIGV4aXN0cyAoUEQuZGlhZ25vc2lzLnJlZmVyZW5jZSBSIHdoZXJlIFIgPSBDLmlkKSkKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBjbGFpbSBkaWFnbm9zaXMgZWxlbWVudHMgZm9yIHRoZSBnaXZlbiBlbmNvdW50ZXIKKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBjbGFpbURpYWdub3NpcyhlbmNvdW50ZXIgRW5jb3VudGVyKToKICBlbmNvdW50ZXIgRQogICAgbGV0IAogICAgICBjbGFpbTogKFtDbGFpbV0gQyB3aGVyZSBDLnN0YXR1cyA9ICdhY3RpdmUnIGFuZCBDLnVzZSA9ICdjbGFpbScgYW5kIGV4aXN0cyAoQy5pdGVtIEkgd2hlcmUgSS5lbmNvdW50ZXIucmVmZXJlbmNlcyhFKSkpLAogICAgICBjbGFpbUl0ZW06IChjbGFpbS5pdGVtIEkgd2hlcmUgSS5lbmNvdW50ZXIucmVmZXJlbmNlcyhFKSkKICAgIHJldHVybiBjbGFpbS5kaWFnbm9zaXMgRCB3aGVyZSBELnNlcXVlbmNlIGluIGNsYWltSXRlbS5kaWFnbm9zaXNTZXF1ZW5jZQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBMb2NhdGlvbiByZXNvdXJjZSBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuIHJlZmVyZW5jZQpAZGVwcmVjYXRlZDogVGhpcyBmdW5jdGlvbiBpcyBkZXByZWNhdGVkLiBVc2UgdGhlIGZsdWVudCBmdW5jdGlvbiBgZ2V0TG9jYXRpb24oKWAgaW5zdGVhZC4KKi8KZGVmaW5lIGZ1bmN0aW9uICJHZXRMb2NhdGlvbiIocmVmZXJlbmNlIFJlZmVyZW5jZSk6CiAgc2luZ2xldG9uIGZyb20gKAogICAgW0xvY2F0aW9uXSBMIHdoZXJlIHJlZmVyZW5jZS5yZWZlcmVuY2VzKEwpCiAgKQoKLyoKQGRlc2NyaXB0aW9uOiBSZXR1cm5zIHRoZSBMb2NhdGlvbiByZXNvdXJjZSBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuIHJlZmVyZW5jZS4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBnZXRMb2NhdGlvbihyZWZlcmVuY2UgUmVmZXJlbmNlKToKICBzaW5nbGV0b24gZnJvbSAoCiAgICBbTG9jYXRpb25dIEwgd2hlcmUgcmVmZXJlbmNlLnJlZmVyZW5jZXMoTCkKICApCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIG1lZGljYXRpb24gY29kZSBmb3IgdGhlIGdpdmVuIE1lZGljYXRpb25SZXF1ZXN0CkBkZXByZWNhdGVkOiBUaGlzIGZ1bmN0aW9uIGlzIGRlcHJlY2F0ZWQuIFVzZSB0aGUgZmx1ZW50IGZ1bmN0aW9uIGBnZXRNZWRpY2F0aW9uQ29kZSgpYCBpbnN0ZWFkLgoqLwpkZWZpbmUgZnVuY3Rpb24gIkdldE1lZGljYXRpb25Db2RlIihyZXF1ZXN0IE1lZGljYXRpb25SZXF1ZXN0KToKICBpZiByZXF1ZXN0Lm1lZGljYXRpb24gaXMgQ29uY2VwdCB0aGVuCiAgCSAgcmVxdWVzdC5tZWRpY2F0aW9uIGFzIENvbmNlcHQKICAJZWxzZQogIAkgIChzaW5nbGV0b24gZnJvbSAoW01lZGljYXRpb25dIE0gd2hlcmUgcmVxdWVzdC5tZWRpY2F0aW9uLnJlZmVyZW5jZXMoTSkpKS5jb2RlCgovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIG1lZGljYXRpb24gY29kZSBmb3IgdGhlIGdpdmVuIE1lZGljYXRpb25SZXF1ZXN0CiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gZ2V0TWVkaWNhdGlvbkNvZGUocmVxdWVzdCBNZWRpY2F0aW9uUmVxdWVzdCk6CiAgaWYgcmVxdWVzdC5tZWRpY2F0aW9uIGlzIENvbmNlcHQgdGhlbgogIAkgIHJlcXVlc3QubWVkaWNhdGlvbiBhcyBDb25jZXB0CiAgCWVsc2UKICAJICAoc2luZ2xldG9uIGZyb20gKFtNZWRpY2F0aW9uXSBNIHdoZXJlIHJlcXVlc3QubWVkaWNhdGlvbi5yZWZlcmVuY2VzKE0pKSkuY29kZQogIAkgIAovKgpAZGVzY3JpcHRpb246IFJldHVybnMgdGhlIGNsYWltIHByb2NlZHVyZSBlbGVtZW50cyBmb3IgdGhlIGdpdmVuIGVuY291bnRlcgoqLwpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIHByaW5jaXBhbFByb2NlZHVyZShlbmNvdW50ZXIgRW5jb3VudGVyKTogIAkgIAogIAkgZW5jb3VudGVyIEUKICAJIGxldCAKICAgICAgICBjbGFpbTogW0NsYWltXSBDIHdoZXJlIEMuc3RhdHVzID0gJ2FjdGl2ZScgYW5kIEMudXNlID0gJ2NsYWltJyBhbmQgZXhpc3RzIChDLml0ZW0gSSB3aGVyZSBJLmVuY291bnRlci5yZWZlcmVuY2VzKEUpKSwKICAgICAgICBjbGFpbUl0ZW06IGNsYWltLml0ZW0gSSB3aGVyZSBJLmVuY291bnRlci5yZWZlcmVuY2VzKEUpLAogICAgICAgIGNsYWltUHJvY2VkdXJlOiBjbGFpbS5wcm9jZWR1cmUgUCB3aGVyZSBQLnNlcXVlbmNlIGluIGNsYWltSXRlbS5wcm9jZWR1cmVTZXF1ZW5jZQogICAgICB3aGVyZSBjbGFpbVByb2NlZHVyZS50eXBlLmluY2x1ZGVzQ29kZSgiUHJpbWFyeSBwcm9jZWR1cmUiKQ=="
  } ]
}