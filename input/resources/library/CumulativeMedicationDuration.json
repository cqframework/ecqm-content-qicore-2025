{
  "resourceType": "Library",
  "id": "CumulativeMedicationDuration",
  "meta": {
    "profile": [ "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-shareablelibrary", "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-computablelibrary", "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-publishablelibrary", "http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-executablelibrary", "http://hl7.org/fhir/uv/cql/StructureDefinition/cql-library", "http://hl7.org/fhir/uv/cql/StructureDefinition/elm-json-library", "http://hl7.org/fhir/uv/cql/StructureDefinition/elm-xml-library" ]
  },
  "language": "en",
  "text": {
    "status": "extensions",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\">\n    <table class=\"grid dict\">\n        \n        \n        <tr>\n            <th scope=\"row\"><b>Title: </b></th>\n            <td style=\"padding-left: 4px;\">CumulativeMedicationDuration</td>\n        </tr>\n        \n\n        \n        \n        <tr>\n            <th scope=\"row\"><b>Id: </b></th>\n            <td style=\"padding-left: 4px;\">CumulativeMedicationDuration</td>\n        </tr>\n        \n\n        \n        \n        <tr>\n            <th scope=\"row\"><b>Version: </b></th>\n            <td style=\"padding-left: 4px;\">5.0.000</td>\n        </tr>\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Url: </b></th>\n            <td style=\"padding-left: 4px;\">https://madie.cms.gov/Library/CumulativeMedicationDuration</td>\n        </tr>\n        \n\n        \n        <tr>\n            <th scope=\"row\">\n                <b>\n                    \n                        official\n                    \n                </b>\n            </th>\n            <td style=\"padding-left: 4px;\">\n                \n                <p style=\"margin-bottom: 5px;\">\n                    <span>67928e2094e897688edaf46a</span>\n                </p>\n                \n            </td>\n        </tr>\n        \n\n        \n\n        \n\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Type: </b></th>\n            <td style=\"padding-left: 4px;\">\n                \n                    \n                        \n                        <p style=\"margin-bottom: 5px;\">\n                            <b>system: </b> <span>http://terminology.hl7.org/CodeSystem/library-type</span>\n                        </p>\n                        \n                        \n                        <p style=\"margin-bottom: 5px;\">\n                            <b>code: </b> <span>logic-library</span>\n                        </p>\n                        \n                        \n                    \n                \n                \n            </td>\n        </tr>\n        \n\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Date: </b></th>\n            <td style=\"padding-left: 4px;\">2025-05-27T15:45:21+00:00</td>\n        </tr>\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Publisher: </b></th>\n            <td style=\"padding-left: 4px;\">ICF</td>\n        </tr>\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Description: </b></th>\n            <td style=\"padding-left: 4px;\">This library provides cumulative medication duration calculation\nlogic for use with FHIR medication prescription, administration, and dispensing\nresources. The logic here follows the guidance provided as part of the 5.6\nversion of Quality Data Model.</td>\n        </tr>\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n\n        \n        <tr>\n            <th scope=\"row\"><b>Related Artifacts: </b></th>\n            <td style=\"padding-left: 4px;\">\n                \n                \n                \n                <p><b>Dependencies</b></p>\n                <ul>\n                  \n                    <li>https://madie.cms.gov/Library/FHIRHelpers|4.4.000</li>\n                  \n                    <li>https://madie.cms.gov/Library/QICoreCommon|3.0.000</li>\n                  \n                    <li>http://terminology.hl7.org/CodeSystem/v3-TimingEvent</li>\n                  \n                    <li>http://hl7.org/fhir/event-timing</li>\n                  \n                </ul>\n                \n                \n                \n                \n                \n            </td>\n        </tr>\n        \n\n        \n\n        \n        <tr>\n          <th scope=\"row\"><b>Data Requirements:</b></th>\n          <td style=\"padding-left: 4px;\">\n            <table class=\"grid-dict\">\n              <tr><th><b>Type</b></th><th><b>Profile</b></th><th><b>MS</b></th><th><b>Code Filter</b></th></tr>\n              \n                <tr>\n                  <th>MedicationAdministration</th>\n                  <th>http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-medicationadministration</th>\n                  <th>;;</th>\n                  <th>\n                    \n                  </th>\n                </tr>\n              \n            </table>\n          </td>\n        </tr>\n        \n\n        \n        \n        <tr>\n          <td colspan=\"2\">\n            <table>\n              <tr><th><a id=\"cql-content\"><b>Content: </b></a> text/cql</th></tr>\n              <tr><td><pre><code class=\"language-cql\">library CumulativeMedicationDuration version '5.0.000'\n\nusing QICore version '6.0.0'\n\ninclude FHIRHelpers version '4.4.000' called FHIRHelpers\ninclude QICoreCommon version '3.0.000'\n\n// These code systems are not known to the MAT environment yet, request to have them added submitted\ncodesystem &quot;V3TimingEvent&quot;: 'http://terminology.hl7.org/CodeSystem/v3-TimingEvent'\ncodesystem &quot;EventTiming&quot;: 'http://hl7.org/fhir/event-timing'\n\ncode &quot;HS&quot;: 'HS' from &quot;V3TimingEvent&quot; // event occurs [offset] before the hour of sleep (or trying to)\ncode &quot;WAKE&quot;: 'WAKE' from &quot;V3TimingEvent&quot; // event occurs [offset] after waking\ncode &quot;C&quot;: 'C' from &quot;V3TimingEvent&quot; //\tevent occurs at a meal (from the Latin cibus)\ncode &quot;CM&quot;: 'CM' from &quot;V3TimingEvent&quot; //\tevent occurs at breakfast (from the Latin cibus matutinus)\ncode &quot;CD&quot;: 'CD' from &quot;V3TimingEvent&quot; //\tevent occurs at lunch (from the Latin cibus diurnus)\ncode &quot;CV&quot;: 'CV' from &quot;V3TimingEvent&quot; //\tevent occurs at dinner (from the Latin ante cibus vespertinus)\ncode &quot;AC&quot;: 'AC' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] before a meal (from the Latin ante cibus)\ncode &quot;ACM&quot;: 'ACM' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] before breakfast (from the Latin ante cibus matutinus)\ncode &quot;ACD&quot;: 'ACD' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] before lunch (from the Latin ante cibus diurnus)\ncode &quot;ACV&quot;: 'ACV' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] before dinner (from the Latin ante cibus vespertinus)\ncode &quot;PC&quot;: 'PC' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] after a meal (from the Latin post cibus)\ncode &quot;PCM&quot;: 'PCM' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] after breakfast (from the Latin post cibus matutinus)\ncode &quot;PCD&quot;: 'PCD' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] after lunch (from the Latin post cibus diurnus)\ncode &quot;PCV&quot;: 'PCV' from &quot;V3TimingEvent&quot; //\tevent occurs [offset] after dinner (from the Latin post cibus vespertinus)\n\ncode &quot;MORN&quot;: 'MORN' from EventTiming //\tEvent occurs during the morning. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;MORN.early&quot;: 'MORN.early' from EventTiming //\tEarly Morning\tEvent occurs during the early morning. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;MORN.late&quot;: 'MORN.late' from EventTiming // Late Morning\tEvent occurs during the late morning. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;NOON&quot;: 'NOON' from EventTiming //\tNoon\tEvent occurs around 12:00pm. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;AFT&quot;: 'AFT' from EventTiming //\tAfternoon\tEvent occurs during the afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;AFT.early&quot;: 'AFT.early' from EventTiming //\tEarly Afternoon\tEvent occurs during the early afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;AFT.late&quot;: 'AFT.late' from EventTiming //\tLate Afternoon\tEvent occurs during the late afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;EVE&quot;: 'EVE' from EventTiming //\tEvening\tEvent occurs during the evening. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;EVE.early&quot;: 'EVE.early' from EventTiming //\tEarly Evening\tEvent occurs during the early evening. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;EVE.late&quot;: 'EVE.late' from EventTiming //\tLate Evening\tEvent occurs during the late evening. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;NIGHT&quot;: 'NIGHT' from EventTiming //\tNight\tEvent occurs during the night. The exact time is unspecified and established by institution convention or patient interpretation.\ncode &quot;PHS&quot;: 'PHS' from EventTiming //\tAfter Sleep\tEvent occurs [offset] after subject goes to sleep. The exact time is unspecified and established by institution convention or patient interpretation.\n\ncode &quot;Every eight hours (qualifier value)&quot;: '307469008' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every eight hours (qualifier value)'\ncode &quot;Every eight to twelve hours (qualifier value)&quot;: '396140003' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every eight to twelve hours (qualifier value)'\ncode &quot;Every forty eight hours (qualifier value)&quot;: '396131002' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every forty eight hours (qualifier value)'\ncode &quot;Every forty hours (qualifier value)&quot;: '396130001' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every forty hours (qualifier value)'\ncode &quot;Every four hours (qualifier value)&quot;: '225756002' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every four hours (qualifier value)'\ncode &quot;Every seventy two hours (qualifier value)&quot;: '396143001' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every seventy two hours (qualifier value)'\ncode &quot;Every six hours (qualifier value)&quot;: '307468000' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every six hours (qualifier value)'\ncode &quot;Every six to eight hours (qualifier value)&quot;: '396139000' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every six to eight hours (qualifier value)'\ncode &quot;Every thirty six hours (qualifier value)&quot;: '396126004' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every thirty six hours (qualifier value)'\ncode &quot;Every three to four hours (qualifier value)&quot;: '225754004' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every three to four hours (qualifier value)'\ncode &quot;Every three to six hours (qualifier value)&quot;: '396127008' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every three to six hours (qualifier value)'\ncode &quot;Every twelve hours (qualifier value)&quot;: '307470009' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every twelve hours (qualifier value)'\ncode &quot;Every twenty four hours (qualifier value)&quot;: '396125000' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every twenty four hours (qualifier value)'\ncode &quot;Every two to four hours (qualifier value)&quot;: '225752000' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Every two to four hours (qualifier value)'\ncode &quot;Four times daily (qualifier value)&quot;: '307439001' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Four times daily (qualifier value)'\ncode &quot;Once daily (qualifier value)&quot;: '229797004' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Once daily (qualifier value)'\ncode &quot;One to four times a day (qualifier value)&quot;: '396109005' from QICoreCommon.&quot;SNOMEDCT&quot; display 'One to four times a day (qualifier value)'\ncode &quot;One to three times a day (qualifier value)&quot;: '396108002' from QICoreCommon.&quot;SNOMEDCT&quot; display 'One to three times a day (qualifier value)'\ncode &quot;One to two times a day (qualifier value)&quot;: '396107007' from QICoreCommon.&quot;SNOMEDCT&quot; display 'One to two times a day (qualifier value)'\ncode &quot;Three times daily (qualifier value)&quot;: '229798009' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Three times daily (qualifier value)'\ncode &quot;Twice a day (qualifier value)&quot;: '229799001' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Twice a day (qualifier value)'\ncode &quot;Two to four times a day (qualifier value)&quot;: '396111001' from QICoreCommon.&quot;SNOMEDCT&quot; display 'Two to four times a day (qualifier value)'\n\nparameter ErrorLevel String default 'Warning'\n\ncontext Patient\n\n/*\n Goal is to get to number of days\n Two broad approaches to the calculation:\n  1) Based on supply and frequency, calculate the number of expected days the medication will cover/has covered\n  2) Based on relevant period, determine a covered interval and calculate the length of that interval in days\nThis topic covers several use cases and illustrates how to calculate Cumulative\nMedication Duration for each type of medication resource using the supply and\nfrequency approach.\n*/\n\n/*\n  For the first approach, we need to get from frequency to a frequency/day\n  So we define ToDaily\n*/\n\n/*\n  Calculates daily frequency given frequency within a period\n*/\ndefine function ToDaily(frequency System.Integer, period System.Quantity):\n  case period.unit\n    when 'h' then frequency * (24.0 / period.value)\n    when 'min' then frequency * (24.0 / period.value) * 60\n    when 's' then frequency * (24.0 / period.value) * 60 * 60\n    when 'd' then frequency * (24.0 / period.value) / 24\n    when 'wk' then frequency * (24.0 / period.value) / (24 * 7)\n    when 'mo' then frequency * (24.0 / period.value) / (24 * 30) /* assuming 30 days in month */\n    when 'a' then frequency * (24.0 / period.value) / (24 * 365) /* assuming 365 days in year */\n    when 'hour' then frequency * (24.0 / period.value)\n    when 'minute' then frequency * (24.0 / period.value) * 60\n    when 'second' then frequency * (24.0 / period.value) * 60 * 60\n    when 'day' then frequency * (24.0 / period.value) / 24\n    when 'week' then frequency * (24.0 / period.value) / (24 * 7)\n    when 'month' then frequency * (24.0 / period.value) / (24 * 30) /* assuming 30 days in month */\n    when 'year' then frequency * (24.0 / period.value) / (24 * 365) /* assuming 365 days in year */\n    when 'hours' then frequency * (24.0 / period.value)\n    when 'minutes' then frequency * (24.0 / period.value) * 60\n    when 'seconds' then frequency * (24.0 / period.value) * 60 * 60\n    when 'days' then frequency * (24.0 / period.value) / 24\n    when 'weeks' then frequency * (24.0 / period.value) / (24 * 7)\n    when 'months' then frequency * (24.0 / period.value) / (24 * 30) /* assuming 30 days in month */\n    when 'years' then frequency * (24.0 / period.value) / (24 * 365) /* assuming 365 days in year */\n    else Message(null, true, 'CMDLogic.ToDaily.UnknownUnit', ErrorLevel, 'Unknown unit ' &amp; period.unit)\n  end\n\n/*\n  Returns a daily frequency for the given code representation of frequency.\n  The function expects codes from the [EventTiming](http://hl7.org/fhir/codesystem-event-timing.html) or\n  [V3TimingEvent](http://hl7.org/fhir/v3/TimingEvent/cs.html) code systems.\n  // TODO: Determine whether or not we should use timing.code at all....\n*/\ndefine function ToDaily(frequency Code):\n  case\n    when frequency ~ &quot;HS&quot; then 1 // event occurs [offset] before the hour of sleep (or trying to)\n    when frequency ~ &quot;WAKE&quot; then 1 // event occurs [offset] after waking\n    when frequency ~ &quot;C&quot; then 3 //\tevent occurs at a meal (from the Latin cibus)\n    when frequency ~ &quot;CM&quot; then 1 //\tevent occurs at breakfast (from the Latin cibus matutinus)\n    when frequency ~ &quot;CD&quot; then 1 //\tevent occurs at lunch (from the Latin cibus diurnus)\n    when frequency ~ &quot;CV&quot; then 1 //\tevent occurs at dinner (from the Latin ante cibus vespertinus)\n    when frequency ~ &quot;AC&quot; then 3 //\tevent occurs [offset] before a meal (from the Latin ante cibus)\n    when frequency ~ &quot;ACM&quot; then 1 //\tevent occurs [offset] before breakfast (from the Latin ante cibus matutinus)\n    when frequency ~ &quot;ACD&quot; then 1 //\tevent occurs [offset] before lunch (from the Latin ante cibus diurnus)\n    when frequency ~ &quot;ACV&quot; then 1 //\tevent occurs [offset] before dinner (from the Latin ante cibus vespertinus)\n    when frequency ~ &quot;PC&quot; then 3 //\tevent occurs [offset] after a meal (from the Latin post cibus)\n    when frequency ~ &quot;PCM&quot; then 1 //\tevent occurs [offset] after breakfast (from the Latin post cibus matutinus)\n    when frequency ~ &quot;PCD&quot; then 1 //\tevent occurs [offset] after lunch (from the Latin post cibus diurnus)\n    when frequency ~ &quot;PCV&quot; then 1 //\tevent occurs [offset] after dinner (from the Latin post cibus vespertinus)\n\n    when frequency ~ &quot;MORN&quot; then 1 //\tEvent occurs during the morning. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;MORN.early&quot; then 1 //\tEarly Morning\tEvent occurs during the early morning. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;MORN.late&quot; then 1 // Late Morning\tEvent occurs during the late morning. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;NOON&quot; then 1 //\tNoon\tEvent occurs around 12:00pm. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;AFT&quot; then 1 //\tAfternoon\tEvent occurs during the afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;AFT.early&quot; then 1 //\tEarly Afternoon\tEvent occurs during the early afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;AFT.late&quot; then 1 //\tLate Afternoon\tEvent occurs during the late afternoon. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;EVE&quot; then 1 //\tEvening\tEvent occurs during the evening. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;EVE.early&quot; then 1 //\tEarly Evening\tEvent occurs during the early evening. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;EVE.late&quot; then 1 //\tLate Evening\tEvent occurs during the late evening. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;NIGHT&quot; then 1 //\tNight\tEvent occurs during the night. The exact time is unspecified and established by institution convention or patient interpretation.\n    when frequency ~ &quot;PHS&quot; then 1 //\tAfter Sleep\tEvent occurs [offset] after subject goes to sleep. The exact time is unspecified and established by institution convention or patient interpretation.\n\n    when frequency ~ &quot;Once daily (qualifier value)&quot; then 1.0\n    when frequency ~ &quot;Twice a day (qualifier value)&quot; then 2.0\n    when frequency ~ &quot;Three times daily (qualifier value)&quot; then 3.0\n    when frequency ~ &quot;Four times daily (qualifier value)&quot; then 4.0\n    when frequency ~ &quot;Every twenty four hours (qualifier value)&quot; then 1.0\n    when frequency ~ &quot;Every twelve hours (qualifier value)&quot; then 2.0\n    when frequency ~ &quot;Every thirty six hours (qualifier value)&quot; then 0.67\n    when frequency ~ &quot;Every eight hours (qualifier value)&quot; then 3.0\n    when frequency ~ &quot;Every four hours (qualifier value)&quot; then 6.0\n    when frequency ~ &quot;Every six hours (qualifier value)&quot; then 4.0\n    when frequency ~ &quot;Every seventy two hours (qualifier value)&quot; then 0.33\n    when frequency ~ &quot;Every forty eight hours (qualifier value)&quot; then 0.5\n    when frequency ~ &quot;Every eight to twelve hours (qualifier value)&quot; then 3.0\n    when frequency ~ &quot;Every six to eight hours (qualifier value)&quot; then 4.0\n    when frequency ~ &quot;Every three to four hours (qualifier value)&quot; then 8.0\n    when frequency ~ &quot;Every three to six hours (qualifier value)&quot; then 8.0\n    when frequency ~ &quot;Every two to four hours (qualifier value)&quot; then 12.0\n    when frequency ~ &quot;One to four times a day (qualifier value)&quot; then 4.0\n    when frequency ~ &quot;One to three times a day (qualifier value)&quot; then 3.0\n    when frequency ~ &quot;One to two times a day (qualifier value)&quot; then 2.0\n    when frequency ~ &quot;Two to four times a day (qualifier value)&quot; then 4.0\n\n    else Message(null, true, 'CMDLogic.ToDaily.UnknownFrequencyCode', ErrorLevel, 'Unknown frequency code ' &amp; frequency.code)\n  end\n\n/*\nNow that we have a ToDaily function, we can approach calculation of the\nduration of medication for an order. First, consider the definitions\nfor each element:\n* 1 and only 1 dosageInstruction\n* 1 and only 1 doseAndRate\n* 1 timing with 1 repeat\n* frequency, frequencyMax, defaulting to 1\n* period, periodUnit, defaulting to 1 'd'\n* doseQuantity or doseRange\n* timeOfDay\n* authoredOn: The date the prescription was written\n* dispenseRequest.validityPeriod: Time period supply is authorized for\n* dispenseRequest.quantity: amount of medication supplied per dispense\n* dispenseRequest.numberOfRepeatsAllowed: number of refills authorized\n* dispenseRequest.expectedSupplyDuration: number of days supply per dispense\n* dosageInstruction.timing.repeat.boundsDuration: total duration of the repeat\n* dosageInstruction.timing.repeat.boundsRange: range of durations of the repeat\n* dosageInstruction.timing.repeat.boundsPeriod: period bounds of the repeat\n* dosageInstruction.timing.repeat.count: number of times to repeat\n* dosageInstruction.timing.repeat.countMax: maximum number of times to repeat\n* dosageInstruction.timing.repeat.frequency: event occurs frequency times per period\n* dosageInstruction.timing.repeat.frequencyMax: event occurs up to frequencyMax times per period\n* dosageInstruction.timing.repeat.period: event occurs frequency times per period\n* dosageInstruction.timing.repeat.periodMax: upper limit of period\n* dosageInstruction.timing.repeat.periodUnit: period duration (s | min | h | d | wk | mo | a)\n* dosageInstruction.timing.repeat.timeOfDay: time of day for the event (0..*)\n* dosageInstruction.timing.repeat.when: event timing (HS | WAKE | C | CM | CD | CV | AC | ACM...)\n* dosageInstruction.timing.code: BID | TID | QID | AM | PM | QD | QOD...\n* dosageInstruction.asNeeded\n* dosageInstruction.doseAndRate.doseQuantity\n* dosageInstruction.doseAndRate.doseRange\nIf expectedSupplyDuration is present, then the duration is\n    expectedSupplyDuration * (1 + numberOfRepeatsAllowed)\nIf expectedSupplyDuration is not present, then it must be calculated based on the quantity, dosage, and frequency:\n    (quantity / (dosage * frequency)) * (1 + numberOfRepeatsAllowed)\n    dosage: Coalesce(end of doseAndRate.doseRange, doseAndRate.doseQuantity)\n    frequency: Coalesce(frequencyMax, frequency)\n    period: Quantity(period, periodUnit)\nIf expectedSupplyDuration is not present and cannot be calculated, and the boundsPeriod is present (and completely specified), we can use that directly\n    dosage.timing.repeat.boundsPeriod\nThis calculation results in a number of days, which can then be turned into a period by anchoring that to the\nstart of the validityPeriod or the authoredOn:\n    Interval[earliestDispensable, earliestDispensable + expectedSupplyDuration - 1]\n    earliestDispensable: Coalesce(start of validityPeriod, authoredOn)\nThe following function illustrates this completely:\n*/\n\n/*\nCalculates the Medication Period for a single MedicationRequest.\nMedicationRequest instances provided to this function are expected\nto conform to the [MMEMedicationRequest](http://build.fhir.org/ig/cqframework/opioid-mme-r4/StructureDefinition-mmemedicationrequest.html)\nprofile, which expects:\n* 1 and only 1 dosageInstruction, multiple dosageInstruction elements will result in an error\n* 1 and only 1 doseAndRate, multiple doseAndRate elements will result in an error\n* 1 timing with 1 repeat, missing timing or repeat elements will result in a null\n* frequency, frequencyMax, defaulting to 1\n* period, periodUnit, defaulting to 1 'd'\n* timeOfDay\n* doseQuantity or doseRange, missing doseQuantity and doseRange will result in a null\nNote that MedicationRequest status is not considered by this calculation, as the\nlist of MedicationRequest instances provided to this function should already have\nconsidered appropriate statuses, depending on the use case, typically `completed`.\n*/\ndefine function MedicationRequestPeriod(Request &quot;MedicationRequest&quot;):\n  Request R\n    let\n      dosage: singleton from R.dosageInstruction,\n      doseAndRate: singleton from dosage.doseAndRate,\n      timing: dosage.timing,\n      frequency: Coalesce(timing.repeat.frequencyMax, timing.repeat.frequency),\n      period: Quantity(timing.repeat.period, timing.repeat.periodUnit),\n      doseRange: doseAndRate.dose,\n      doseQuantity: doseAndRate.dose,\n      dose: Coalesce(end of doseRange, doseQuantity),\n      dosesPerDay: Coalesce(ToDaily(frequency, period), Count(timing.repeat.timeOfDay), 1.0),\n      boundsPeriod: timing.repeat.bounds as Interval&lt;DateTime&gt;,\n      daysSupply: (convert R.dispenseRequest.expectedSupplyDuration to days).value,\n      quantity: R.dispenseRequest.quantity,\n      refills: Coalesce(R.dispenseRequest.numberOfRepeatsAllowed, 0),\n      startDate:\n        Coalesce(\n          date from start of boundsPeriod,\n          date from R.authoredOn,\n          date from start of R.dispenseRequest.validityPeriod\n        ),\n      totalDaysSupplied: Coalesce(daysSupply, quantity.value / (dose.value * dosesPerDay)) * (1 + refills)\n    return\n      if startDate is not null and totalDaysSupplied is not null then\n        Interval[startDate, startDate + Quantity(totalDaysSupplied - 1, 'day') ]\n      else if startDate is not null and boundsPeriod.&quot;high&quot; is not null then\n        Interval[startDate, date from end of boundsPeriod]\n      else\n        null\n\n define fluent function medicationRequestPeriod(Request &quot;MedicationRequest&quot;):\n  Request R\n    let\n      dosage: singleton from R.dosageInstruction,\n      doseAndRate: singleton from dosage.doseAndRate,\n      timing: dosage.timing,\n      frequency: Coalesce(timing.repeat.frequencyMax, timing.repeat.frequency),\n      period: Quantity(timing.repeat.period, timing.repeat.periodUnit),\n      doseRange: doseAndRate.dose,\n      doseQuantity: doseAndRate.dose,\n      dose: Coalesce(end of doseRange, doseQuantity),\n      dosesPerDay: Coalesce(ToDaily(frequency, period), Count(timing.repeat.timeOfDay), 1.0),\n      boundsPeriod: timing.repeat.bounds as Interval&lt;DateTime&gt;,\n      daysSupply: (convert R.dispenseRequest.expectedSupplyDuration to days).value,\n      quantity: R.dispenseRequest.quantity,\n      refills: Coalesce(R.dispenseRequest.numberOfRepeatsAllowed, 0),\n      startDate:\n        Coalesce(\n          date from start of boundsPeriod,\n          date from R.authoredOn,\n          date from start of R.dispenseRequest.validityPeriod\n        ),\n      totalDaysSupplied: Coalesce(daysSupply, quantity.value / (dose.value * dosesPerDay)) * (1 + refills)\n    return\n      if startDate is not null and totalDaysSupplied is not null then\n        Interval[startDate, startDate + Quantity(totalDaysSupplied - 1, 'day') ]\n      else if startDate is not null and boundsPeriod.&quot;high&quot; is not null then\n        Interval[startDate, date from end of boundsPeriod]\n      else\n        null\n\n/*\nNext, consider the MedicationDispense case:\n* whenPrepared: When product was prepared\n* whenHandedOver: When product was given out\n* quantity: Amount dispensed\n* daysSupply: Amount of medication expressed as a timing amount\n* dosageInstruction.timing.repeat.boundsDuration: total duration of the repeat\n* dosageInstruction.timing.repeat.boundsRange: range of durations of the repeat\n* dosageInstruction.timing.repeat.boundsPeriod: period bounds of the repeat\n* dosageInstruction.timing.repeat.count: number of times to repeat\n* dosageInstruction.timing.repeat.countMax: maximum number of times to repeat\n* dosageInstruction.timing.repeat.frequency: event occurs frequency times per period\n* dosageInstruction.timing.repeat.frequencyMax: event occurs up to frequencyMax times per period\n* dosageInstruction.timing.repeat.period: event occurs frequency times per period\n* dosageInstruction.timing.repeat.periodMax: upper limit of period\n* dosageInstruction.timing.repeat.periodUnit: period duration (s | min | h | d | wk | mo | a)\n* dosageInstruction.timing.repeat.timeOfDay: time of day for the event (0..*)\n* dosageInstruction.timing.repeat.when: event timing (HS | WAKE | C | CM | CD | CV | AC | ACM...)\n* dosageInstruction.timing.code: BID | TID | QID | AM | PM | QD | QOD...\n* dosageInstruction.asNeeded\n* dosageInstruction.doseAndRate.doseQuantity\n* dosageInstruction.doseAndRate.doseRange\nWe have effectively the same elements, with the same meanings, with the exception that the\nevent is documenting a single dispense, and does not contain refill information. In addition,\nmultiple dispense events would typically be present, and those would all have to be considered\nas part of an overall calculation. That will be considered when we combine results, but for\nthis function, we'll focus on calculating the duration of a single dispense.\nWith a MedicationDispense, dosage information is expected to be the same as the related\nMedicationRequest, so boundsPeriod would still cover the entire prescription (including refills)\nand so cannot be used to calculate the interval covered by the dispense.\nIf the daysSupply element is present, then the duration in days is simply\n    daysSupply\nNote specifically that we are not considering refills, as those would be covered\nby subsequent dispense records.\nIf daysSupplied is not present, then daysSupplied must be calculated based on\nthe quantity, dosage, and frequency:\n    (quantity / (dosage * frequency))\nThis calculation results in a number of days, which can then be turned into a\nperiod by anchoring that to the startDate, as determined by the first available\nvalue of the start of the boundsPeriod, whenHandedOver, and whenPrepared.\n   Interval[startDate, startDate + totalDaysSupplied - 1 day]\n*/\n\n/*\nCalculates Medication Period for a given MedicationDispense\nMedicationDispense instances provided to this function are expected\nto conform to the [TODO: MMEMedicationDispense](http://build.fhir.org/ig/cqframework/opioid-mme-r4/StructureDefinition-mmemedicationdispense.html)\nprofile, which expects:\n* 1 and only 1 dosageInstruction, multiple dosageInstruction elements will result in an error\n* 1 and only 1 doseAndRate, multiple doseAndRate elements will result in an error\n* 1 timing with 1 repeat, missing timing or repeat elements will result in a null\n* frequency, frequencyMax, defaulting to 1\n* period, periodUnit, defaulting to 1 'd'\n* timeOfDay\n* doseQuantity or doseRange, missing doseQuantity and doseRange will result in a null\n* whenHandedOver or whenPrepared, if missing both whenHandedOver and whenPrepared will result in a null\nNote that MedicationDispense status is not considered by this calculation, as the\nlist of MedicationDispense instances provided to this function should already have\nconsidered appropriate statuses, depending on the use case, typically `completed`,\nespecially since whenHandedOver would be expected to be present for a completed\nMedicationDispense.\nNote also that the dosage information recorded in a dispense is expected to be a copy of the\ndispense information from the related medication request. As such, the boundsPeriod would be expected\nto cover the entire range, and should _not_ be used for timing of the event.\nThere is also active discussion in the Pharmacy WG about what date should be used if whenPrepared/whenHandedOver is not present.\nThis may take the form of an &quot;original creation date&quot;, but may also be a &quot;status change date&quot; for dispense events that are updating\nstatus of an existing dispense. That discussion is ongoing, so until that is resolved, this logic will return\nnull if whenPrepared/whenHandedOver are not available.\n*/\ndefine function MedicationDispensePeriod(Dispense &quot;MedicationDispense&quot;):\n  Dispense D\n    let\n      dosage: singleton from D.dosageInstruction,\n      doseAndRate: singleton from dosage.doseAndRate,\n      timing: dosage.timing,\n      frequency: Coalesce(timing.repeat.frequencyMax, timing.repeat.frequency),\n      period: Quantity(timing.repeat.period, timing.repeat.periodUnit),\n      doseRange: doseAndRate.dose,\n      doseQuantity: doseAndRate.dose,\n      dose: Coalesce(end of doseRange, doseQuantity),\n      daysSupply: (convert D.daysSupply to days).value,\n      dosesPerDay: Coalesce(ToDaily(frequency, period), Count(timing.repeat.timeOfDay), 1.0),\n      startDate:\n        Coalesce(\n          date from D.whenHandedOver,\n          date from D.whenPrepared\n        ),\n      totalDaysSupplied: Coalesce(daysSupply, D.quantity.value / (dose.value * dosesPerDay))\n    return\n      if startDate is not null and totalDaysSupplied is not null then\n        Interval[startDate, startDate + Quantity(totalDaysSupplied - 1, 'day')]\n      else\n        null\n\n /*\nCalculates Medication Period for a given MedicationDispense\nMedicationDispense instances provided to this function are expected\nto conform to the [TODO: MMEMedicationDispense](http://build.fhir.org/ig/cqframework/opioid-mme-r4/StructureDefinition-mmemedicationdispense.html)\nprofile, which expects:\n* 1 and only 1 dosageInstruction, multiple dosageInstruction elements will result in an error\n* 1 and only 1 doseAndRate, multiple doseAndRate elements will result in an error\n* 1 timing with 1 repeat, missing timing or repeat elements will result in a null\n* frequency, frequencyMax, defaulting to 1\n* period, periodUnit, defaulting to 1 'd'\n* timeOfDay\n* doseQuantity or doseRange, missing doseQuantity and doseRange will result in a null\n* whenHandedOver or whenPrepared, if missing both whenHandedOver and whenPrepared will result in a null\nNote that MedicationDispense status is not considered by this calculation, as the\nlist of MedicationDispense instances provided to this function should already have\nconsidered appropriate statuses, depending on the use case, typically `completed`,\nespecially since whenHandedOver would be expected to be present for a completed\nMedicationDispense.\nNote also that the dosage information recorded in a dispense is expected to be a copy of the\ndispense information from the related medication request. As such, the boundsPeriod would be expected\nto cover the entire range, and should _not_ be used for timing of the event.\nThere is also active discussion in the Pharmacy WG about what date should be used if whenPrepared/whenHandedOver is not present.\nThis may take the form of an &quot;original creation date&quot;, but may also be a &quot;status change date&quot; for dispense events that are updating\nstatus of an existing dispense. That discussion is ongoing, so until that is resolved, this logic will return\nnull if whenPrepared/whenHandedOver are not available.\n*/\ndefine fluent function medicationDispensePeriod(Dispense &quot;MedicationDispense&quot;):\n  Dispense D\n    let\n      dosage: singleton from D.dosageInstruction,\n      doseAndRate: singleton from dosage.doseAndRate,\n      timing: dosage.timing,\n      frequency: Coalesce(timing.repeat.frequencyMax, timing.repeat.frequency),\n      period: Quantity(timing.repeat.period, timing.repeat.periodUnit),\n      doseRange: doseAndRate.dose,\n      doseQuantity: doseAndRate.dose,\n      dose: Coalesce(end of doseRange, doseQuantity),\n      daysSupply: (convert D.daysSupply to days).value,\n      dosesPerDay: Coalesce(ToDaily(frequency, period), Count(timing.repeat.timeOfDay), 1.0),\n      startDate:\n        Coalesce(\n          date from D.whenHandedOver,\n          date from D.whenPrepared\n        ),\n      totalDaysSupplied: Coalesce(daysSupply, D.quantity.value / (dose.value * dosesPerDay))\n    return\n      if startDate is not null and totalDaysSupplied is not null then\n        Interval[startDate, startDate + Quantity(totalDaysSupplied - 1, 'day')]\n      else\n        null\n \n/*\nReturns the established therapeutic duration for a given medication.\nThis is likely measure specific, though could potentially be established for\nany drug and distributed as a CodeSystem supplement.\nDefaulting to 14 days here for illustration.\n*/\ndefine function TherapeuticDuration(medication Concept):\n  14 days\n\n /*\nNext we consider MedicationAdministration. This data type is typically used to\ncapture specific administration, with the relevantPeriod capturing start and stop\ntime of the administration event:\n* effective[x]: Start and end time of administration\nHowever, when calculating cumulative medication duration, it is typically the\ntherapeutic period of the medication that should be considered. Currently neither\nthe Medication nor MedicationKnowledge resources provide this information, so\nwe model it here as a function that can potentially be implemented in a variety\nof ways, including measure-specific values, as well as distribution as an RxNorm\ncode system supplement.\nHowever it is obtained, if therapeutic duration can be obtained, and the effective\nperiod has a start, the result will be\n    Interval[startDate, startDate + therapeuticDuration - 1 day]\nNOTE: Therapeutic duration needs to be established and until a way is implemented to\ndo that based on the medication, this logic is incomplete and should not be used.\n*/\ndefine function MedicationAdministrationPeriod(Administration &quot;MedicationAdministration&quot;):\n  Administration M\n    let\n      therapeuticDuration: TherapeuticDuration(Administration.medication),\n      startDate: date from start of Administration.effective\n    return\n      if startDate is not null and therapeuticDuration is not null then\n        Interval[startDate, startDate + therapeuticDuration - 1]\n      else\n        null\n\n /*\nNext we consider MedicationAdministration. This data type is typically used to\ncapture specific administration, with the relevantPeriod capturing start and stop\ntime of the administration event:\n* effective[x]: Start and end time of administration\nHowever, when calculating cumulative medication duration, it is typically the\ntherapeutic period of the medication that should be considered. Currently neither\nthe Medication nor MedicationKnowledge resources provide this information, so\nwe model it here as a function that can potentially be implemented in a variety\nof ways, including measure-specific values, as well as distribution as an RxNorm\ncode system supplement.\nHowever it is obtained, if therapeutic duration can be obtained, and the effective\nperiod has a start, the result will be\n    Interval[startDate, startDate + therapeuticDuration - 1 day]\nNOTE: Therapeutic duration needs to be established and until a way is implemented to\ndo that based on the medication, this logic is incomplete and should not be used.\n*/\ndefine fluent function medicationAdministrationPeriod(Administration &quot;MedicationAdministration&quot;):\n  Administration M\n    let\n      therapeuticDuration: TherapeuticDuration(Administration.medication),\n      startDate: date from start of Administration.effective\n    return\n      if startDate is not null and therapeuticDuration is not null then\n        Interval[startDate, startDate + therapeuticDuration - 1]\n      else\n        null\n\n/*\nNow that we have functions for determining the medication period for individual\nprescriptions, administrations, and dispenses, we can combine those using\nan overall cumulative medication duration calculation.\nThere are two broad approaches to calculating cumulative duration, one that _collapses_\noverlapping intervals so that calculations are not duplicated, and one that _rolls out_\noverlapping intervals so that the durations are laid end-to-end.\nFirst, we define a function that simply calculates CumulativeDuration of a set of\nintervals:\n*/\ndefine function CumulativeDuration(Intervals List&lt;Interval&lt;Date&gt;&gt;):\n   if Intervals is not null then ( Sum((collapse Intervals per day)X\n        return all(difference in days between start of X and \n          end of X\n        )+ 1\n    )\n  ) \n    else null\n\n /*\nNow that we have functions for determining the medication period for individual\nprescriptions, administrations, and dispenses, we can combine those using\nan overall cumulative medication duration calculation.\nThere are two broad approaches to calculating cumulative duration, one that _collapses_\noverlapping intervals so that calculations are not duplicated, and one that _rolls out_\noverlapping intervals so that the durations are laid end-to-end.\nFirst, we define a function that simply calculates CumulativeDuration of a set of\nintervals:\n*/\ndefine fluent function cumulativeDuration(Intervals List&lt;Interval&lt;Date&gt;&gt;):\n   if Intervals is not null then ( Sum((collapse Intervals per day)X\n        return all(difference in days between start of X and \n          end of X\n        )+ 1\n    )\n  ) \n    else null\n\n /*\nNext, we define a function that rolls out intervals:\n*/\ndefine function RolloutIntervals(intervals List&lt;Interval&lt;Date&gt;&gt;):\n intervals I aggregate all R starting ( null as List&lt;Interval&lt;Date&gt;&gt;): R\n    union ( { I X\n        let S: Max({ \n          end of Last(R)+ 1 day, start of X }\n        ),\n        E: S + Quantity(Coalesce(duration in days of X, 0), 'day')\n        return Interval[S, E]}\n    )\n\n  /*\nNext, we define a function that rolls out intervals:\n*/\ndefine fluent function rolloutIntervals(intervals List&lt;Interval&lt;Date&gt;&gt;):\n intervals I aggregate all R starting ( null as List&lt;Interval&lt;Date&gt;&gt;): R\n    union ( { I X\n        let S: Max({ \n          end of Last(R)+ 1 day, start of X }\n        ),\n        E: S + Quantity(Coalesce(duration in days of X, 0), 'day')\n        return Interval[S, E]}\n    )\n\n/*\nThen, we define a function that allows us to calculate based on the various medication\ntypes:\n*/\n\ndefine function MedicationPeriod(\n  medication Choice&lt;&quot;MedicationRequest&quot;,\n    &quot;MedicationDispense&quot;\n  &gt;):\n  case\n    when medication is MedicationRequest then MedicationRequestPeriod(medication)\n    when medication is MedicationDispense then MedicationDispensePeriod(medication)\n    else null\n  end\n\n /*\nThen, we define a function that allows us to calculate based on the various medication\ntypes:\n*/\n\ndefine fluent function medicationPeriod(\n  medication Choice&lt;&quot;MedicationRequest&quot;,\n    &quot;MedicationDispense&quot;\n  &gt;):\n  case\n    when medication is MedicationRequest then medication.medicationRequestPeriod()\n    when medication is MedicationDispense then medication.medicationDispensePeriod()\n    else null\n  end\n\n/*\nWe can then use this function, combined with the MedicationDuration functions above\nto calculate Cumulative Medication Duration:\nGenerally speaking, we want to _roll out_ intervals from dispense and administration\nevents, and then collapse across that result and intervals from prescriptions.\nNote also that the separation of medications by type should already be done\nby this stage as well.\nCalculations that combine dosages from different types of medications (such as Morphine Milligram Equivalent (MME)\nor Average MME) require further consideration.\n*/\n\ndefine function CumulativeMedicationDuration(\n  Medications List&lt;Choice&lt;&quot;MedicationRequest&quot;,\n    &quot;MedicationDispense&quot;\n  &gt;&gt;):\n  CumulativeDuration((\n      Medications M\n        where M is MedicationRequest\n        return MedicationRequestPeriod(M)\n    )\n      union (\n        RolloutIntervals(\n          Medications M\n            where M is MedicationDispense\n            return MedicationDispensePeriod(M)\n        )\n      )\n  )\n\n /*\nWe can then use this function, combined with the MedicationDuration functions above\nto calculate Cumulative Medication Duration:\nGenerally speaking, we want to _roll out_ intervals from dispense and administration\nevents, and then collapse across that result and intervals from prescriptions.\nNote also that the separation of medications by type should already be done\nby this stage as well.\nCalculations that combine dosages from different types of medications (such as Morphine Milligram Equivalent (MME)\nor Average MME) require further consideration.\n*/\n\ndefine fluent function cumulativeMedicationDuration(\nMedications List&lt;Choice&lt;&quot;MedicationRequest&quot;,\n&quot;MedicationDispense&quot;\n&gt;&gt;):\n((\nMedications M\nwhere M is MedicationRequest\nreturn M.medicationRequestPeriod()\n)\nunion (\n(\nMedications M\nwhere M is MedicationDispense\nreturn M.medicationDispensePeriod()\n).rolloutIntervals()\n)\n).cumulativeDuration()\n  /**********************************************************************/\n/* Functions in this region are copied from opioid-mme-r4             */\n/**********************************************************************/\n\ndefine function Quantity(value Decimal, unit String):\n  if value is not null then\n    System.Quantity { value: value, unit: unit }\n  else\n    null</code></pre></td></tr>\n            </table>\n          </td>\n        </tr>\n        \n        \n        \n    </table>\n</div>"
  },
  "contained": [ {
    "resourceType": "Parameters",
    "id": "options",
    "parameter": [ {
      "name": "translatorVersion",
      "valueString": "3.25.0"
    }, {
      "name": "option",
      "valueString": "EnableAnnotations"
    }, {
      "name": "option",
      "valueString": "EnableLocators"
    }, {
      "name": "option",
      "valueString": "DisableListDemotion"
    }, {
      "name": "option",
      "valueString": "DisableListPromotion"
    }, {
      "name": "format",
      "valueString": "JSON"
    }, {
      "name": "format",
      "valueString": "XML"
    }, {
      "name": "analyzeDataRequirements",
      "valueBoolean": false
    }, {
      "name": "collapseDataRequirements",
      "valueBoolean": false
    }, {
      "name": "compatibilityLevel",
      "valueString": "1.5"
    }, {
      "name": "enableCqlOnly",
      "valueBoolean": false
    }, {
      "name": "errorLevel",
      "valueString": "Info"
    }, {
      "name": "signatureLevel",
      "valueString": "Overloads"
    }, {
      "name": "validateUnits",
      "valueBoolean": true
    }, {
      "name": "verifyOnly",
      "valueBoolean": false
    } ]
  } ],
  "extension": [ {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "HS",
      "display": "HS"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "WAKE",
      "display": "WAKE"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "C",
      "display": "C"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "CM",
      "display": "CM"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "CD",
      "display": "CD"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "CV",
      "display": "CV"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "AC",
      "display": "AC"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "ACM",
      "display": "ACM"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "ACD",
      "display": "ACD"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "ACV",
      "display": "ACV"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "PC",
      "display": "PC"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "PCM",
      "display": "PCM"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "PCD",
      "display": "PCD"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://terminology.hl7.org/CodeSystem/v3-TimingEvent",
      "code": "PCV",
      "display": "PCV"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "MORN",
      "display": "MORN"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "MORN.early",
      "display": "MORN.early"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "MORN.late",
      "display": "MORN.late"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "NOON",
      "display": "NOON"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "AFT",
      "display": "AFT"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "AFT.early",
      "display": "AFT.early"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "AFT.late",
      "display": "AFT.late"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "EVE",
      "display": "EVE"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "EVE.early",
      "display": "EVE.early"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "EVE.late",
      "display": "EVE.late"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "NIGHT",
      "display": "NIGHT"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-directReferenceCode",
    "valueCoding": {
      "system": "http://hl7.org/fhir/event-timing",
      "code": "PHS",
      "display": "PHS"
    }
  }, {
    "url": "http://hl7.org/fhir/StructureDefinition/cqf-cqlOptions",
    "valueReference": {
      "reference": "#options"
    }
  } ],
  "url": "https://madie.cms.gov/Library/CumulativeMedicationDuration",
  "identifier": [ {
    "use": "official",
    "system": "https://madie.cms.gov/login",
    "value": "67928e2094e897688edaf46a"
  } ],
  "version": "5.0.000",
  "name": "CumulativeMedicationDuration",
  "title": "CumulativeMedicationDuration",
  "status": "active",
  "experimental": false,
  "type": {
    "coding": [ {
      "system": "http://terminology.hl7.org/CodeSystem/library-type",
      "code": "logic-library"
    } ]
  },
  "date": "2025-05-27T15:45:21+00:00",
  "publisher": "ICF",
  "description": "This library provides cumulative medication duration calculation\nlogic for use with FHIR medication prescription, administration, and dispensing\nresources. The logic here follows the guidance provided as part of the 5.6\nversion of Quality Data Model.",
  "content": [ {
    "contentType": "text/cql",
    "data": "bGlicmFyeSBDdW11bGF0aXZlTWVkaWNhdGlvbkR1cmF0aW9uIHZlcnNpb24gJzUuMC4wMDAnCgp1c2luZyBRSUNvcmUgdmVyc2lvbiAnNi4wLjAnCgppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuNC4wMDAnIGNhbGxlZCBGSElSSGVscGVycwppbmNsdWRlIFFJQ29yZUNvbW1vbiB2ZXJzaW9uICczLjAuMDAwJwoKLy8gVGhlc2UgY29kZSBzeXN0ZW1zIGFyZSBub3Qga25vd24gdG8gdGhlIE1BVCBlbnZpcm9ubWVudCB5ZXQsIHJlcXVlc3QgdG8gaGF2ZSB0aGVtIGFkZGVkIHN1Ym1pdHRlZApjb2Rlc3lzdGVtICJWM1RpbWluZ0V2ZW50IjogJ2h0dHA6Ly90ZXJtaW5vbG9neS5obDcub3JnL0NvZGVTeXN0ZW0vdjMtVGltaW5nRXZlbnQnCmNvZGVzeXN0ZW0gIkV2ZW50VGltaW5nIjogJ2h0dHA6Ly9obDcub3JnL2ZoaXIvZXZlbnQtdGltaW5nJwoKY29kZSAiSFMiOiAnSFMnIGZyb20gIlYzVGltaW5nRXZlbnQiIC8vIGV2ZW50IG9jY3VycyBbb2Zmc2V0XSBiZWZvcmUgdGhlIGhvdXIgb2Ygc2xlZXAgKG9yIHRyeWluZyB0bykKY29kZSAiV0FLRSI6ICdXQUtFJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLyBldmVudCBvY2N1cnMgW29mZnNldF0gYWZ0ZXIgd2FraW5nCmNvZGUgIkMiOiAnQycgZnJvbSAiVjNUaW1pbmdFdmVudCIgLy8JZXZlbnQgb2NjdXJzIGF0IGEgbWVhbCAoZnJvbSB0aGUgTGF0aW4gY2lidXMpCmNvZGUgIkNNIjogJ0NNJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLwlldmVudCBvY2N1cnMgYXQgYnJlYWtmYXN0IChmcm9tIHRoZSBMYXRpbiBjaWJ1cyBtYXR1dGludXMpCmNvZGUgIkNEIjogJ0NEJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLwlldmVudCBvY2N1cnMgYXQgbHVuY2ggKGZyb20gdGhlIExhdGluIGNpYnVzIGRpdXJudXMpCmNvZGUgIkNWIjogJ0NWJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLwlldmVudCBvY2N1cnMgYXQgZGlubmVyIChmcm9tIHRoZSBMYXRpbiBhbnRlIGNpYnVzIHZlc3BlcnRpbnVzKQpjb2RlICJBQyI6ICdBQycgZnJvbSAiVjNUaW1pbmdFdmVudCIgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSBhIG1lYWwgKGZyb20gdGhlIExhdGluIGFudGUgY2lidXMpCmNvZGUgIkFDTSI6ICdBQ00nIGZyb20gIlYzVGltaW5nRXZlbnQiIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBiZWZvcmUgYnJlYWtmYXN0IChmcm9tIHRoZSBMYXRpbiBhbnRlIGNpYnVzIG1hdHV0aW51cykKY29kZSAiQUNEIjogJ0FDRCcgZnJvbSAiVjNUaW1pbmdFdmVudCIgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSBsdW5jaCAoZnJvbSB0aGUgTGF0aW4gYW50ZSBjaWJ1cyBkaXVybnVzKQpjb2RlICJBQ1YiOiAnQUNWJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLwlldmVudCBvY2N1cnMgW29mZnNldF0gYmVmb3JlIGRpbm5lciAoZnJvbSB0aGUgTGF0aW4gYW50ZSBjaWJ1cyB2ZXNwZXJ0aW51cykKY29kZSAiUEMiOiAnUEMnIGZyb20gIlYzVGltaW5nRXZlbnQiIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBhIG1lYWwgKGZyb20gdGhlIExhdGluIHBvc3QgY2lidXMpCmNvZGUgIlBDTSI6ICdQQ00nIGZyb20gIlYzVGltaW5nRXZlbnQiIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBicmVha2Zhc3QgKGZyb20gdGhlIExhdGluIHBvc3QgY2lidXMgbWF0dXRpbnVzKQpjb2RlICJQQ0QiOiAnUENEJyBmcm9tICJWM1RpbWluZ0V2ZW50IiAvLwlldmVudCBvY2N1cnMgW29mZnNldF0gYWZ0ZXIgbHVuY2ggKGZyb20gdGhlIExhdGluIHBvc3QgY2lidXMgZGl1cm51cykKY29kZSAiUENWIjogJ1BDVicgZnJvbSAiVjNUaW1pbmdFdmVudCIgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGFmdGVyIGRpbm5lciAoZnJvbSB0aGUgTGF0aW4gcG9zdCBjaWJ1cyB2ZXNwZXJ0aW51cykKCmNvZGUgIk1PUk4iOiAnTU9STicgZnJvbSBFdmVudFRpbWluZyAvLwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBtb3JuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgpjb2RlICJNT1JOLmVhcmx5IjogJ01PUk4uZWFybHknIGZyb20gRXZlbnRUaW1pbmcgLy8JRWFybHkgTW9ybmluZwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBlYXJseSBtb3JuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgpjb2RlICJNT1JOLmxhdGUiOiAnTU9STi5sYXRlJyBmcm9tIEV2ZW50VGltaW5nIC8vIExhdGUgTW9ybmluZwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBsYXRlIG1vcm5pbmcuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCmNvZGUgIk5PT04iOiAnTk9PTicgZnJvbSBFdmVudFRpbWluZyAvLwlOb29uCUV2ZW50IG9jY3VycyBhcm91bmQgMTI6MDBwbS4gVGhlIGV4YWN0IHRpbWUgaXMgdW5zcGVjaWZpZWQgYW5kIGVzdGFibGlzaGVkIGJ5IGluc3RpdHV0aW9uIGNvbnZlbnRpb24gb3IgcGF0aWVudCBpbnRlcnByZXRhdGlvbi4KY29kZSAiQUZUIjogJ0FGVCcgZnJvbSBFdmVudFRpbWluZyAvLwlBZnRlcm5vb24JRXZlbnQgb2NjdXJzIGR1cmluZyB0aGUgYWZ0ZXJub29uLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgpjb2RlICJBRlQuZWFybHkiOiAnQUZULmVhcmx5JyBmcm9tIEV2ZW50VGltaW5nIC8vCUVhcmx5IEFmdGVybm9vbglFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBlYXJseSBhZnRlcm5vb24uIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCmNvZGUgIkFGVC5sYXRlIjogJ0FGVC5sYXRlJyBmcm9tIEV2ZW50VGltaW5nIC8vCUxhdGUgQWZ0ZXJub29uCUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIGxhdGUgYWZ0ZXJub29uLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgpjb2RlICJFVkUiOiAnRVZFJyBmcm9tIEV2ZW50VGltaW5nIC8vCUV2ZW5pbmcJRXZlbnQgb2NjdXJzIGR1cmluZyB0aGUgZXZlbmluZy4gVGhlIGV4YWN0IHRpbWUgaXMgdW5zcGVjaWZpZWQgYW5kIGVzdGFibGlzaGVkIGJ5IGluc3RpdHV0aW9uIGNvbnZlbnRpb24gb3IgcGF0aWVudCBpbnRlcnByZXRhdGlvbi4KY29kZSAiRVZFLmVhcmx5IjogJ0VWRS5lYXJseScgZnJvbSBFdmVudFRpbWluZyAvLwlFYXJseSBFdmVuaW5nCUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIGVhcmx5IGV2ZW5pbmcuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCmNvZGUgIkVWRS5sYXRlIjogJ0VWRS5sYXRlJyBmcm9tIEV2ZW50VGltaW5nIC8vCUxhdGUgRXZlbmluZwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBsYXRlIGV2ZW5pbmcuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCmNvZGUgIk5JR0hUIjogJ05JR0hUJyBmcm9tIEV2ZW50VGltaW5nIC8vCU5pZ2h0CUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIG5pZ2h0LiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgpjb2RlICJQSFMiOiAnUEhTJyBmcm9tIEV2ZW50VGltaW5nIC8vCUFmdGVyIFNsZWVwCUV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBzdWJqZWN0IGdvZXMgdG8gc2xlZXAuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCgpjb2RlICJFdmVyeSBlaWdodCBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICczMDc0NjkwMDgnIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgZWlnaHQgaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkV2ZXJ5IGVpZ2h0IHRvIHR3ZWx2ZSBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICczOTYxNDAwMDMnIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgZWlnaHQgdG8gdHdlbHZlIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpJwpjb2RlICJFdmVyeSBmb3J0eSBlaWdodCBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICczOTYxMzEwMDInIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgZm9ydHkgZWlnaHQgaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkV2ZXJ5IGZvcnR5IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIjogJzM5NjEzMDAwMScgZnJvbSBRSUNvcmVDb21tb24uIlNOT01FRENUIiBkaXNwbGF5ICdFdmVyeSBmb3J0eSBob3VycyAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiRXZlcnkgZm91ciBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICcyMjU3NTYwMDInIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgZm91ciBob3VycyAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiRXZlcnkgc2V2ZW50eSB0d28gaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzk2MTQzMDAxJyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHNldmVudHkgdHdvIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpJwpjb2RlICJFdmVyeSBzaXggaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzA3NDY4MDAwJyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHNpeCBob3VycyAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiRXZlcnkgc2l4IHRvIGVpZ2h0IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIjogJzM5NjEzOTAwMCcgZnJvbSBRSUNvcmVDb21tb24uIlNOT01FRENUIiBkaXNwbGF5ICdFdmVyeSBzaXggdG8gZWlnaHQgaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkV2ZXJ5IHRoaXJ0eSBzaXggaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzk2MTI2MDA0JyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHRoaXJ0eSBzaXggaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkV2ZXJ5IHRocmVlIHRvIGZvdXIgaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMjI1NzU0MDA0JyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHRocmVlIHRvIGZvdXIgaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkV2ZXJ5IHRocmVlIHRvIHNpeCBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICczOTYxMjcwMDgnIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgdGhyZWUgdG8gc2l4IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpJwpjb2RlICJFdmVyeSB0d2VsdmUgaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzA3NDcwMDA5JyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHR3ZWx2ZSBob3VycyAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiRXZlcnkgdHdlbnR5IGZvdXIgaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzk2MTI1MDAwJyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0V2ZXJ5IHR3ZW50eSBmb3VyIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpJwpjb2RlICJFdmVyeSB0d28gdG8gZm91ciBob3VycyAocXVhbGlmaWVyIHZhbHVlKSI6ICcyMjU3NTIwMDAnIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnRXZlcnkgdHdvIHRvIGZvdXIgaG91cnMgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIkZvdXIgdGltZXMgZGFpbHkgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzA3NDM5MDAxJyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ0ZvdXIgdGltZXMgZGFpbHkgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIk9uY2UgZGFpbHkgKHF1YWxpZmllciB2YWx1ZSkiOiAnMjI5Nzk3MDA0JyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ09uY2UgZGFpbHkgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIk9uZSB0byBmb3VyIHRpbWVzIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIjogJzM5NjEwOTAwNScgZnJvbSBRSUNvcmVDb21tb24uIlNOT01FRENUIiBkaXNwbGF5ICdPbmUgdG8gZm91ciB0aW1lcyBhIGRheSAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiT25lIHRvIHRocmVlIHRpbWVzIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIjogJzM5NjEwODAwMicgZnJvbSBRSUNvcmVDb21tb24uIlNOT01FRENUIiBkaXNwbGF5ICdPbmUgdG8gdGhyZWUgdGltZXMgYSBkYXkgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIk9uZSB0byB0d28gdGltZXMgYSBkYXkgKHF1YWxpZmllciB2YWx1ZSkiOiAnMzk2MTA3MDA3JyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ09uZSB0byB0d28gdGltZXMgYSBkYXkgKHF1YWxpZmllciB2YWx1ZSknCmNvZGUgIlRocmVlIHRpbWVzIGRhaWx5IChxdWFsaWZpZXIgdmFsdWUpIjogJzIyOTc5ODAwOScgZnJvbSBRSUNvcmVDb21tb24uIlNOT01FRENUIiBkaXNwbGF5ICdUaHJlZSB0aW1lcyBkYWlseSAocXVhbGlmaWVyIHZhbHVlKScKY29kZSAiVHdpY2UgYSBkYXkgKHF1YWxpZmllciB2YWx1ZSkiOiAnMjI5Nzk5MDAxJyBmcm9tIFFJQ29yZUNvbW1vbi4iU05PTUVEQ1QiIGRpc3BsYXkgJ1R3aWNlIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpJwpjb2RlICJUd28gdG8gZm91ciB0aW1lcyBhIGRheSAocXVhbGlmaWVyIHZhbHVlKSI6ICczOTYxMTEwMDEnIGZyb20gUUlDb3JlQ29tbW9uLiJTTk9NRURDVCIgZGlzcGxheSAnVHdvIHRvIGZvdXIgdGltZXMgYSBkYXkgKHF1YWxpZmllciB2YWx1ZSknCgpwYXJhbWV0ZXIgRXJyb3JMZXZlbCBTdHJpbmcgZGVmYXVsdCAnV2FybmluZycKCmNvbnRleHQgUGF0aWVudAoKLyoKIEdvYWwgaXMgdG8gZ2V0IHRvIG51bWJlciBvZiBkYXlzCiBUd28gYnJvYWQgYXBwcm9hY2hlcyB0byB0aGUgY2FsY3VsYXRpb246CiAgMSkgQmFzZWQgb24gc3VwcGx5IGFuZCBmcmVxdWVuY3ksIGNhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIGV4cGVjdGVkIGRheXMgdGhlIG1lZGljYXRpb24gd2lsbCBjb3Zlci9oYXMgY292ZXJlZAogIDIpIEJhc2VkIG9uIHJlbGV2YW50IHBlcmlvZCwgZGV0ZXJtaW5lIGEgY292ZXJlZCBpbnRlcnZhbCBhbmQgY2FsY3VsYXRlIHRoZSBsZW5ndGggb2YgdGhhdCBpbnRlcnZhbCBpbiBkYXlzClRoaXMgdG9waWMgY292ZXJzIHNldmVyYWwgdXNlIGNhc2VzIGFuZCBpbGx1c3RyYXRlcyBob3cgdG8gY2FsY3VsYXRlIEN1bXVsYXRpdmUKTWVkaWNhdGlvbiBEdXJhdGlvbiBmb3IgZWFjaCB0eXBlIG9mIG1lZGljYXRpb24gcmVzb3VyY2UgdXNpbmcgdGhlIHN1cHBseSBhbmQKZnJlcXVlbmN5IGFwcHJvYWNoLgoqLwoKLyoKICBGb3IgdGhlIGZpcnN0IGFwcHJvYWNoLCB3ZSBuZWVkIHRvIGdldCBmcm9tIGZyZXF1ZW5jeSB0byBhIGZyZXF1ZW5jeS9kYXkKICBTbyB3ZSBkZWZpbmUgVG9EYWlseQoqLwoKLyoKICBDYWxjdWxhdGVzIGRhaWx5IGZyZXF1ZW5jeSBnaXZlbiBmcmVxdWVuY3kgd2l0aGluIGEgcGVyaW9kCiovCmRlZmluZSBmdW5jdGlvbiBUb0RhaWx5KGZyZXF1ZW5jeSBTeXN0ZW0uSW50ZWdlciwgcGVyaW9kIFN5c3RlbS5RdWFudGl0eSk6CiAgY2FzZSBwZXJpb2QudW5pdAogICAgd2hlbiAnaCcgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkKICAgIHdoZW4gJ21pbicgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgKiA2MAogICAgd2hlbiAncycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgKiA2MCAqIDYwCiAgICB3aGVuICdkJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvIDI0CiAgICB3aGVuICd3aycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiA3KQogICAgd2hlbiAnbW8nIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogMzApIC8qIGFzc3VtaW5nIDMwIGRheXMgaW4gbW9udGggKi8KICAgIHdoZW4gJ2EnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpIC8gKDI0ICogMzY1KSAvKiBhc3N1bWluZyAzNjUgZGF5cyBpbiB5ZWFyICovCiAgICB3aGVuICdob3VyJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKQogICAgd2hlbiAnbWludXRlJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAqIDYwCiAgICB3aGVuICdzZWNvbmQnIHRoZW4gZnJlcXVlbmN5ICogKDI0LjAgLyBwZXJpb2QudmFsdWUpICogNjAgKiA2MAogICAgd2hlbiAnZGF5JyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvIDI0CiAgICB3aGVuICd3ZWVrJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvICgyNCAqIDcpCiAgICB3aGVuICdtb250aCcgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiAzMCkgLyogYXNzdW1pbmcgMzAgZGF5cyBpbiBtb250aCAqLwogICAgd2hlbiAneWVhcicgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiAzNjUpIC8qIGFzc3VtaW5nIDM2NSBkYXlzIGluIHllYXIgKi8KICAgIHdoZW4gJ2hvdXJzJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKQogICAgd2hlbiAnbWludXRlcycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgKiA2MAogICAgd2hlbiAnc2Vjb25kcycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgKiA2MCAqIDYwCiAgICB3aGVuICdkYXlzJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvIDI0CiAgICB3aGVuICd3ZWVrcycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiA3KQogICAgd2hlbiAnbW9udGhzJyB0aGVuIGZyZXF1ZW5jeSAqICgyNC4wIC8gcGVyaW9kLnZhbHVlKSAvICgyNCAqIDMwKSAvKiBhc3N1bWluZyAzMCBkYXlzIGluIG1vbnRoICovCiAgICB3aGVuICd5ZWFycycgdGhlbiBmcmVxdWVuY3kgKiAoMjQuMCAvIHBlcmlvZC52YWx1ZSkgLyAoMjQgKiAzNjUpIC8qIGFzc3VtaW5nIDM2NSBkYXlzIGluIHllYXIgKi8KICAgIGVsc2UgTWVzc2FnZShudWxsLCB0cnVlLCAnQ01ETG9naWMuVG9EYWlseS5Vbmtub3duVW5pdCcsIEVycm9yTGV2ZWwsICdVbmtub3duIHVuaXQgJyAmIHBlcmlvZC51bml0KQogIGVuZAoKLyoKICBSZXR1cm5zIGEgZGFpbHkgZnJlcXVlbmN5IGZvciB0aGUgZ2l2ZW4gY29kZSByZXByZXNlbnRhdGlvbiBvZiBmcmVxdWVuY3kuCiAgVGhlIGZ1bmN0aW9uIGV4cGVjdHMgY29kZXMgZnJvbSB0aGUgW0V2ZW50VGltaW5nXShodHRwOi8vaGw3Lm9yZy9maGlyL2NvZGVzeXN0ZW0tZXZlbnQtdGltaW5nLmh0bWwpIG9yCiAgW1YzVGltaW5nRXZlbnRdKGh0dHA6Ly9obDcub3JnL2ZoaXIvdjMvVGltaW5nRXZlbnQvY3MuaHRtbCkgY29kZSBzeXN0ZW1zLgogIC8vIFRPRE86IERldGVybWluZSB3aGV0aGVyIG9yIG5vdCB3ZSBzaG91bGQgdXNlIHRpbWluZy5jb2RlIGF0IGFsbC4uLi4KKi8KZGVmaW5lIGZ1bmN0aW9uIFRvRGFpbHkoZnJlcXVlbmN5IENvZGUpOgogIGNhc2UKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkhTIiB0aGVuIDEgLy8gZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSB0aGUgaG91ciBvZiBzbGVlcCAob3IgdHJ5aW5nIHRvKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiV0FLRSIgdGhlbiAxIC8vIGV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciB3YWtpbmcKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkMiIHRoZW4gMyAvLwlldmVudCBvY2N1cnMgYXQgYSBtZWFsIChmcm9tIHRoZSBMYXRpbiBjaWJ1cykKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkNNIiB0aGVuIDEgLy8JZXZlbnQgb2NjdXJzIGF0IGJyZWFrZmFzdCAoZnJvbSB0aGUgTGF0aW4gY2lidXMgbWF0dXRpbnVzKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiQ0QiIHRoZW4gMSAvLwlldmVudCBvY2N1cnMgYXQgbHVuY2ggKGZyb20gdGhlIExhdGluIGNpYnVzIGRpdXJudXMpCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJDViIgdGhlbiAxIC8vCWV2ZW50IG9jY3VycyBhdCBkaW5uZXIgKGZyb20gdGhlIExhdGluIGFudGUgY2lidXMgdmVzcGVydGludXMpCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJBQyIgdGhlbiAzIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBiZWZvcmUgYSBtZWFsIChmcm9tIHRoZSBMYXRpbiBhbnRlIGNpYnVzKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiQUNNIiB0aGVuIDEgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSBicmVha2Zhc3QgKGZyb20gdGhlIExhdGluIGFudGUgY2lidXMgbWF0dXRpbnVzKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiQUNEIiB0aGVuIDEgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSBsdW5jaCAoZnJvbSB0aGUgTGF0aW4gYW50ZSBjaWJ1cyBkaXVybnVzKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiQUNWIiB0aGVuIDEgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGJlZm9yZSBkaW5uZXIgKGZyb20gdGhlIExhdGluIGFudGUgY2lidXMgdmVzcGVydGludXMpCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJQQyIgdGhlbiAzIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBhIG1lYWwgKGZyb20gdGhlIExhdGluIHBvc3QgY2lidXMpCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJQQ00iIHRoZW4gMSAvLwlldmVudCBvY2N1cnMgW29mZnNldF0gYWZ0ZXIgYnJlYWtmYXN0IChmcm9tIHRoZSBMYXRpbiBwb3N0IGNpYnVzIG1hdHV0aW51cykKICAgIHdoZW4gZnJlcXVlbmN5IH4gIlBDRCIgdGhlbiAxIC8vCWV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBsdW5jaCAoZnJvbSB0aGUgTGF0aW4gcG9zdCBjaWJ1cyBkaXVybnVzKQogICAgd2hlbiBmcmVxdWVuY3kgfiAiUENWIiB0aGVuIDEgLy8JZXZlbnQgb2NjdXJzIFtvZmZzZXRdIGFmdGVyIGRpbm5lciAoZnJvbSB0aGUgTGF0aW4gcG9zdCBjaWJ1cyB2ZXNwZXJ0aW51cykKCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJNT1JOIiB0aGVuIDEgLy8JRXZlbnQgb2NjdXJzIGR1cmluZyB0aGUgbW9ybmluZy4gVGhlIGV4YWN0IHRpbWUgaXMgdW5zcGVjaWZpZWQgYW5kIGVzdGFibGlzaGVkIGJ5IGluc3RpdHV0aW9uIGNvbnZlbnRpb24gb3IgcGF0aWVudCBpbnRlcnByZXRhdGlvbi4KICAgIHdoZW4gZnJlcXVlbmN5IH4gIk1PUk4uZWFybHkiIHRoZW4gMSAvLwlFYXJseSBNb3JuaW5nCUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIGVhcmx5IG1vcm5pbmcuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJNT1JOLmxhdGUiIHRoZW4gMSAvLyBMYXRlIE1vcm5pbmcJRXZlbnQgb2NjdXJzIGR1cmluZyB0aGUgbGF0ZSBtb3JuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiTk9PTiIgdGhlbiAxIC8vCU5vb24JRXZlbnQgb2NjdXJzIGFyb3VuZCAxMjowMHBtLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiQUZUIiB0aGVuIDEgLy8JQWZ0ZXJub29uCUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIGFmdGVybm9vbi4gVGhlIGV4YWN0IHRpbWUgaXMgdW5zcGVjaWZpZWQgYW5kIGVzdGFibGlzaGVkIGJ5IGluc3RpdHV0aW9uIGNvbnZlbnRpb24gb3IgcGF0aWVudCBpbnRlcnByZXRhdGlvbi4KICAgIHdoZW4gZnJlcXVlbmN5IH4gIkFGVC5lYXJseSIgdGhlbiAxIC8vCUVhcmx5IEFmdGVybm9vbglFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBlYXJseSBhZnRlcm5vb24uIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJBRlQubGF0ZSIgdGhlbiAxIC8vCUxhdGUgQWZ0ZXJub29uCUV2ZW50IG9jY3VycyBkdXJpbmcgdGhlIGxhdGUgYWZ0ZXJub29uLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiRVZFIiB0aGVuIDEgLy8JRXZlbmluZwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBldmVuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiRVZFLmVhcmx5IiB0aGVuIDEgLy8JRWFybHkgRXZlbmluZwlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBlYXJseSBldmVuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiRVZFLmxhdGUiIHRoZW4gMSAvLwlMYXRlIEV2ZW5pbmcJRXZlbnQgb2NjdXJzIGR1cmluZyB0aGUgbGF0ZSBldmVuaW5nLiBUaGUgZXhhY3QgdGltZSBpcyB1bnNwZWNpZmllZCBhbmQgZXN0YWJsaXNoZWQgYnkgaW5zdGl0dXRpb24gY29udmVudGlvbiBvciBwYXRpZW50IGludGVycHJldGF0aW9uLgogICAgd2hlbiBmcmVxdWVuY3kgfiAiTklHSFQiIHRoZW4gMSAvLwlOaWdodAlFdmVudCBvY2N1cnMgZHVyaW5nIHRoZSBuaWdodC4gVGhlIGV4YWN0IHRpbWUgaXMgdW5zcGVjaWZpZWQgYW5kIGVzdGFibGlzaGVkIGJ5IGluc3RpdHV0aW9uIGNvbnZlbnRpb24gb3IgcGF0aWVudCBpbnRlcnByZXRhdGlvbi4KICAgIHdoZW4gZnJlcXVlbmN5IH4gIlBIUyIgdGhlbiAxIC8vCUFmdGVyIFNsZWVwCUV2ZW50IG9jY3VycyBbb2Zmc2V0XSBhZnRlciBzdWJqZWN0IGdvZXMgdG8gc2xlZXAuIFRoZSBleGFjdCB0aW1lIGlzIHVuc3BlY2lmaWVkIGFuZCBlc3RhYmxpc2hlZCBieSBpbnN0aXR1dGlvbiBjb252ZW50aW9uIG9yIHBhdGllbnQgaW50ZXJwcmV0YXRpb24uCgogICAgd2hlbiBmcmVxdWVuY3kgfiAiT25jZSBkYWlseSAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiAxLjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIlR3aWNlIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDIuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiVGhyZWUgdGltZXMgZGFpbHkgKHF1YWxpZmllciB2YWx1ZSkiIHRoZW4gMy4wCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJGb3VyIHRpbWVzIGRhaWx5IChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDQuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiRXZlcnkgdHdlbnR5IGZvdXIgaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiIHRoZW4gMS4wCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJFdmVyeSB0d2VsdmUgaG91cnMgKHF1YWxpZmllciB2YWx1ZSkiIHRoZW4gMi4wCiAgICB3aGVuIGZyZXF1ZW5jeSB+ICJFdmVyeSB0aGlydHkgc2l4IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDAuNjcKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IGVpZ2h0IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDMuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiRXZlcnkgZm91ciBob3VycyAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiA2LjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IHNpeCBob3VycyAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiA0LjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IHNldmVudHkgdHdvIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDAuMzMKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IGZvcnR5IGVpZ2h0IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDAuNQogICAgd2hlbiBmcmVxdWVuY3kgfiAiRXZlcnkgZWlnaHQgdG8gdHdlbHZlIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDMuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiRXZlcnkgc2l4IHRvIGVpZ2h0IGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDQuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiRXZlcnkgdGhyZWUgdG8gZm91ciBob3VycyAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiA4LjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IHRocmVlIHRvIHNpeCBob3VycyAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiA4LjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIkV2ZXJ5IHR3byB0byBmb3VyIGhvdXJzIChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDEyLjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIk9uZSB0byBmb3VyIHRpbWVzIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDQuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiT25lIHRvIHRocmVlIHRpbWVzIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDMuMAogICAgd2hlbiBmcmVxdWVuY3kgfiAiT25lIHRvIHR3byB0aW1lcyBhIGRheSAocXVhbGlmaWVyIHZhbHVlKSIgdGhlbiAyLjAKICAgIHdoZW4gZnJlcXVlbmN5IH4gIlR3byB0byBmb3VyIHRpbWVzIGEgZGF5IChxdWFsaWZpZXIgdmFsdWUpIiB0aGVuIDQuMAoKICAgIGVsc2UgTWVzc2FnZShudWxsLCB0cnVlLCAnQ01ETG9naWMuVG9EYWlseS5Vbmtub3duRnJlcXVlbmN5Q29kZScsIEVycm9yTGV2ZWwsICdVbmtub3duIGZyZXF1ZW5jeSBjb2RlICcgJiBmcmVxdWVuY3kuY29kZSkKICBlbmQKCi8qCk5vdyB0aGF0IHdlIGhhdmUgYSBUb0RhaWx5IGZ1bmN0aW9uLCB3ZSBjYW4gYXBwcm9hY2ggY2FsY3VsYXRpb24gb2YgdGhlCmR1cmF0aW9uIG9mIG1lZGljYXRpb24gZm9yIGFuIG9yZGVyLiBGaXJzdCwgY29uc2lkZXIgdGhlIGRlZmluaXRpb25zCmZvciBlYWNoIGVsZW1lbnQ6CiogMSBhbmQgb25seSAxIGRvc2FnZUluc3RydWN0aW9uCiogMSBhbmQgb25seSAxIGRvc2VBbmRSYXRlCiogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdAoqIGZyZXF1ZW5jeSwgZnJlcXVlbmN5TWF4LCBkZWZhdWx0aW5nIHRvIDEKKiBwZXJpb2QsIHBlcmlvZFVuaXQsIGRlZmF1bHRpbmcgdG8gMSAnZCcKKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlCiogdGltZU9mRGF5CiogYXV0aG9yZWRPbjogVGhlIGRhdGUgdGhlIHByZXNjcmlwdGlvbiB3YXMgd3JpdHRlbgoqIGRpc3BlbnNlUmVxdWVzdC52YWxpZGl0eVBlcmlvZDogVGltZSBwZXJpb2Qgc3VwcGx5IGlzIGF1dGhvcml6ZWQgZm9yCiogZGlzcGVuc2VSZXF1ZXN0LnF1YW50aXR5OiBhbW91bnQgb2YgbWVkaWNhdGlvbiBzdXBwbGllZCBwZXIgZGlzcGVuc2UKKiBkaXNwZW5zZVJlcXVlc3QubnVtYmVyT2ZSZXBlYXRzQWxsb3dlZDogbnVtYmVyIG9mIHJlZmlsbHMgYXV0aG9yaXplZAoqIGRpc3BlbnNlUmVxdWVzdC5leHBlY3RlZFN1cHBseUR1cmF0aW9uOiBudW1iZXIgb2YgZGF5cyBzdXBwbHkgcGVyIGRpc3BlbnNlCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNEdXJhdGlvbjogdG90YWwgZHVyYXRpb24gb2YgdGhlIHJlcGVhdAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuYm91bmRzUmFuZ2U6IHJhbmdlIG9mIGR1cmF0aW9ucyBvZiB0aGUgcmVwZWF0CiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNQZXJpb2Q6IHBlcmlvZCBib3VuZHMgb2YgdGhlIHJlcGVhdAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuY291bnQ6IG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmNvdW50TWF4OiBtYXhpbXVtIG51bWJlciBvZiB0aW1lcyB0byByZXBlYXQKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeTogZXZlbnQgb2NjdXJzIGZyZXF1ZW5jeSB0aW1lcyBwZXIgcGVyaW9kCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5mcmVxdWVuY3lNYXg6IGV2ZW50IG9jY3VycyB1cCB0byBmcmVxdWVuY3lNYXggdGltZXMgcGVyIHBlcmlvZAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQucGVyaW9kOiBldmVudCBvY2N1cnMgZnJlcXVlbmN5IHRpbWVzIHBlciBwZXJpb2QKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnBlcmlvZE1heDogdXBwZXIgbGltaXQgb2YgcGVyaW9kCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5wZXJpb2RVbml0OiBwZXJpb2QgZHVyYXRpb24gKHMgfCBtaW4gfCBoIHwgZCB8IHdrIHwgbW8gfCBhKQoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQudGltZU9mRGF5OiB0aW1lIG9mIGRheSBmb3IgdGhlIGV2ZW50ICgwLi4qKQoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQud2hlbjogZXZlbnQgdGltaW5nIChIUyB8IFdBS0UgfCBDIHwgQ00gfCBDRCB8IENWIHwgQUMgfCBBQ00uLi4pCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLmNvZGU6IEJJRCB8IFRJRCB8IFFJRCB8IEFNIHwgUE0gfCBRRCB8IFFPRC4uLgoqIGRvc2FnZUluc3RydWN0aW9uLmFzTmVlZGVkCiogZG9zYWdlSW5zdHJ1Y3Rpb24uZG9zZUFuZFJhdGUuZG9zZVF1YW50aXR5CiogZG9zYWdlSW5zdHJ1Y3Rpb24uZG9zZUFuZFJhdGUuZG9zZVJhbmdlCklmIGV4cGVjdGVkU3VwcGx5RHVyYXRpb24gaXMgcHJlc2VudCwgdGhlbiB0aGUgZHVyYXRpb24gaXMKICAgIGV4cGVjdGVkU3VwcGx5RHVyYXRpb24gKiAoMSArIG51bWJlck9mUmVwZWF0c0FsbG93ZWQpCklmIGV4cGVjdGVkU3VwcGx5RHVyYXRpb24gaXMgbm90IHByZXNlbnQsIHRoZW4gaXQgbXVzdCBiZSBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBxdWFudGl0eSwgZG9zYWdlLCBhbmQgZnJlcXVlbmN5OgogICAgKHF1YW50aXR5IC8gKGRvc2FnZSAqIGZyZXF1ZW5jeSkpICogKDEgKyBudW1iZXJPZlJlcGVhdHNBbGxvd2VkKQogICAgZG9zYWdlOiBDb2FsZXNjZShlbmQgb2YgZG9zZUFuZFJhdGUuZG9zZVJhbmdlLCBkb3NlQW5kUmF0ZS5kb3NlUXVhbnRpdHkpCiAgICBmcmVxdWVuY3k6IENvYWxlc2NlKGZyZXF1ZW5jeU1heCwgZnJlcXVlbmN5KQogICAgcGVyaW9kOiBRdWFudGl0eShwZXJpb2QsIHBlcmlvZFVuaXQpCklmIGV4cGVjdGVkU3VwcGx5RHVyYXRpb24gaXMgbm90IHByZXNlbnQgYW5kIGNhbm5vdCBiZSBjYWxjdWxhdGVkLCBhbmQgdGhlIGJvdW5kc1BlcmlvZCBpcyBwcmVzZW50IChhbmQgY29tcGxldGVseSBzcGVjaWZpZWQpLCB3ZSBjYW4gdXNlIHRoYXQgZGlyZWN0bHkKICAgIGRvc2FnZS50aW1pbmcucmVwZWF0LmJvdW5kc1BlcmlvZApUaGlzIGNhbGN1bGF0aW9uIHJlc3VsdHMgaW4gYSBudW1iZXIgb2YgZGF5cywgd2hpY2ggY2FuIHRoZW4gYmUgdHVybmVkIGludG8gYSBwZXJpb2QgYnkgYW5jaG9yaW5nIHRoYXQgdG8gdGhlCnN0YXJ0IG9mIHRoZSB2YWxpZGl0eVBlcmlvZCBvciB0aGUgYXV0aG9yZWRPbjoKICAgIEludGVydmFsW2VhcmxpZXN0RGlzcGVuc2FibGUsIGVhcmxpZXN0RGlzcGVuc2FibGUgKyBleHBlY3RlZFN1cHBseUR1cmF0aW9uIC0gMV0KICAgIGVhcmxpZXN0RGlzcGVuc2FibGU6IENvYWxlc2NlKHN0YXJ0IG9mIHZhbGlkaXR5UGVyaW9kLCBhdXRob3JlZE9uKQpUaGUgZm9sbG93aW5nIGZ1bmN0aW9uIGlsbHVzdHJhdGVzIHRoaXMgY29tcGxldGVseToKKi8KCi8qCkNhbGN1bGF0ZXMgdGhlIE1lZGljYXRpb24gUGVyaW9kIGZvciBhIHNpbmdsZSBNZWRpY2F0aW9uUmVxdWVzdC4KTWVkaWNhdGlvblJlcXVlc3QgaW5zdGFuY2VzIHByb3ZpZGVkIHRvIHRoaXMgZnVuY3Rpb24gYXJlIGV4cGVjdGVkCnRvIGNvbmZvcm0gdG8gdGhlIFtNTUVNZWRpY2F0aW9uUmVxdWVzdF0oaHR0cDovL2J1aWxkLmZoaXIub3JnL2lnL2NxZnJhbWV3b3JrL29waW9pZC1tbWUtcjQvU3RydWN0dXJlRGVmaW5pdGlvbi1tbWVtZWRpY2F0aW9ucmVxdWVzdC5odG1sKQpwcm9maWxlLCB3aGljaCBleHBlY3RzOgoqIDEgYW5kIG9ubHkgMSBkb3NhZ2VJbnN0cnVjdGlvbiwgbXVsdGlwbGUgZG9zYWdlSW5zdHJ1Y3Rpb24gZWxlbWVudHMgd2lsbCByZXN1bHQgaW4gYW4gZXJyb3IKKiAxIGFuZCBvbmx5IDEgZG9zZUFuZFJhdGUsIG11bHRpcGxlIGRvc2VBbmRSYXRlIGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGFuIGVycm9yCiogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdCwgbWlzc2luZyB0aW1pbmcgb3IgcmVwZWF0IGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIGZyZXF1ZW5jeSwgZnJlcXVlbmN5TWF4LCBkZWZhdWx0aW5nIHRvIDEKKiBwZXJpb2QsIHBlcmlvZFVuaXQsIGRlZmF1bHRpbmcgdG8gMSAnZCcKKiB0aW1lT2ZEYXkKKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlLCBtaXNzaW5nIGRvc2VRdWFudGl0eSBhbmQgZG9zZVJhbmdlIHdpbGwgcmVzdWx0IGluIGEgbnVsbApOb3RlIHRoYXQgTWVkaWNhdGlvblJlcXVlc3Qgc3RhdHVzIGlzIG5vdCBjb25zaWRlcmVkIGJ5IHRoaXMgY2FsY3VsYXRpb24sIGFzIHRoZQpsaXN0IG9mIE1lZGljYXRpb25SZXF1ZXN0IGluc3RhbmNlcyBwcm92aWRlZCB0byB0aGlzIGZ1bmN0aW9uIHNob3VsZCBhbHJlYWR5IGhhdmUKY29uc2lkZXJlZCBhcHByb3ByaWF0ZSBzdGF0dXNlcywgZGVwZW5kaW5nIG9uIHRoZSB1c2UgY2FzZSwgdHlwaWNhbGx5IGBjb21wbGV0ZWRgLgoqLwpkZWZpbmUgZnVuY3Rpb24gTWVkaWNhdGlvblJlcXVlc3RQZXJpb2QoUmVxdWVzdCAiTWVkaWNhdGlvblJlcXVlc3QiKToKICBSZXF1ZXN0IFIKICAgIGxldAogICAgICBkb3NhZ2U6IHNpbmdsZXRvbiBmcm9tIFIuZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgIGRvc2VBbmRSYXRlOiBzaW5nbGV0b24gZnJvbSBkb3NhZ2UuZG9zZUFuZFJhdGUsCiAgICAgIHRpbWluZzogZG9zYWdlLnRpbWluZywKICAgICAgZnJlcXVlbmN5OiBDb2FsZXNjZSh0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heCwgdGltaW5nLnJlcGVhdC5mcmVxdWVuY3kpLAogICAgICBwZXJpb2Q6IFF1YW50aXR5KHRpbWluZy5yZXBlYXQucGVyaW9kLCB0aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQpLAogICAgICBkb3NlUmFuZ2U6IGRvc2VBbmRSYXRlLmRvc2UsCiAgICAgIGRvc2VRdWFudGl0eTogZG9zZUFuZFJhdGUuZG9zZSwKICAgICAgZG9zZTogQ29hbGVzY2UoZW5kIG9mIGRvc2VSYW5nZSwgZG9zZVF1YW50aXR5KSwKICAgICAgZG9zZXNQZXJEYXk6IENvYWxlc2NlKFRvRGFpbHkoZnJlcXVlbmN5LCBwZXJpb2QpLCBDb3VudCh0aW1pbmcucmVwZWF0LnRpbWVPZkRheSksIDEuMCksCiAgICAgIGJvdW5kc1BlcmlvZDogdGltaW5nLnJlcGVhdC5ib3VuZHMgYXMgSW50ZXJ2YWw8RGF0ZVRpbWU+LAogICAgICBkYXlzU3VwcGx5OiAoY29udmVydCBSLmRpc3BlbnNlUmVxdWVzdC5leHBlY3RlZFN1cHBseUR1cmF0aW9uIHRvIGRheXMpLnZhbHVlLAogICAgICBxdWFudGl0eTogUi5kaXNwZW5zZVJlcXVlc3QucXVhbnRpdHksCiAgICAgIHJlZmlsbHM6IENvYWxlc2NlKFIuZGlzcGVuc2VSZXF1ZXN0Lm51bWJlck9mUmVwZWF0c0FsbG93ZWQsIDApLAogICAgICBzdGFydERhdGU6CiAgICAgICAgQ29hbGVzY2UoCiAgICAgICAgICBkYXRlIGZyb20gc3RhcnQgb2YgYm91bmRzUGVyaW9kLAogICAgICAgICAgZGF0ZSBmcm9tIFIuYXV0aG9yZWRPbiwKICAgICAgICAgIGRhdGUgZnJvbSBzdGFydCBvZiBSLmRpc3BlbnNlUmVxdWVzdC52YWxpZGl0eVBlcmlvZAogICAgICAgICksCiAgICAgIHRvdGFsRGF5c1N1cHBsaWVkOiBDb2FsZXNjZShkYXlzU3VwcGx5LCBxdWFudGl0eS52YWx1ZSAvIChkb3NlLnZhbHVlICogZG9zZXNQZXJEYXkpKSAqICgxICsgcmVmaWxscykKICAgIHJldHVybgogICAgICBpZiBzdGFydERhdGUgaXMgbm90IG51bGwgYW5kIHRvdGFsRGF5c1N1cHBsaWVkIGlzIG5vdCBudWxsIHRoZW4KICAgICAgICBJbnRlcnZhbFtzdGFydERhdGUsIHN0YXJ0RGF0ZSArIFF1YW50aXR5KHRvdGFsRGF5c1N1cHBsaWVkIC0gMSwgJ2RheScpIF0KICAgICAgZWxzZSBpZiBzdGFydERhdGUgaXMgbm90IG51bGwgYW5kIGJvdW5kc1BlcmlvZC4iaGlnaCIgaXMgbm90IG51bGwgdGhlbgogICAgICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgZGF0ZSBmcm9tIGVuZCBvZiBib3VuZHNQZXJpb2RdCiAgICAgIGVsc2UKICAgICAgICBudWxsCgogZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBtZWRpY2F0aW9uUmVxdWVzdFBlcmlvZChSZXF1ZXN0ICJNZWRpY2F0aW9uUmVxdWVzdCIpOgogIFJlcXVlc3QgUgogICAgbGV0CiAgICAgIGRvc2FnZTogc2luZ2xldG9uIGZyb20gUi5kb3NhZ2VJbnN0cnVjdGlvbiwKICAgICAgZG9zZUFuZFJhdGU6IHNpbmdsZXRvbiBmcm9tIGRvc2FnZS5kb3NlQW5kUmF0ZSwKICAgICAgdGltaW5nOiBkb3NhZ2UudGltaW5nLAogICAgICBmcmVxdWVuY3k6IENvYWxlc2NlKHRpbWluZy5yZXBlYXQuZnJlcXVlbmN5TWF4LCB0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeSksCiAgICAgIHBlcmlvZDogUXVhbnRpdHkodGltaW5nLnJlcGVhdC5wZXJpb2QsIHRpbWluZy5yZXBlYXQucGVyaW9kVW5pdCksCiAgICAgIGRvc2VSYW5nZTogZG9zZUFuZFJhdGUuZG9zZSwKICAgICAgZG9zZVF1YW50aXR5OiBkb3NlQW5kUmF0ZS5kb3NlLAogICAgICBkb3NlOiBDb2FsZXNjZShlbmQgb2YgZG9zZVJhbmdlLCBkb3NlUXVhbnRpdHkpLAogICAgICBkb3Nlc1BlckRheTogQ29hbGVzY2UoVG9EYWlseShmcmVxdWVuY3ksIHBlcmlvZCksIENvdW50KHRpbWluZy5yZXBlYXQudGltZU9mRGF5KSwgMS4wKSwKICAgICAgYm91bmRzUGVyaW9kOiB0aW1pbmcucmVwZWF0LmJvdW5kcyBhcyBJbnRlcnZhbDxEYXRlVGltZT4sCiAgICAgIGRheXNTdXBwbHk6IChjb252ZXJ0IFIuZGlzcGVuc2VSZXF1ZXN0LmV4cGVjdGVkU3VwcGx5RHVyYXRpb24gdG8gZGF5cykudmFsdWUsCiAgICAgIHF1YW50aXR5OiBSLmRpc3BlbnNlUmVxdWVzdC5xdWFudGl0eSwKICAgICAgcmVmaWxsczogQ29hbGVzY2UoUi5kaXNwZW5zZVJlcXVlc3QubnVtYmVyT2ZSZXBlYXRzQWxsb3dlZCwgMCksCiAgICAgIHN0YXJ0RGF0ZToKICAgICAgICBDb2FsZXNjZSgKICAgICAgICAgIGRhdGUgZnJvbSBzdGFydCBvZiBib3VuZHNQZXJpb2QsCiAgICAgICAgICBkYXRlIGZyb20gUi5hdXRob3JlZE9uLAogICAgICAgICAgZGF0ZSBmcm9tIHN0YXJ0IG9mIFIuZGlzcGVuc2VSZXF1ZXN0LnZhbGlkaXR5UGVyaW9kCiAgICAgICAgKSwKICAgICAgdG90YWxEYXlzU3VwcGxpZWQ6IENvYWxlc2NlKGRheXNTdXBwbHksIHF1YW50aXR5LnZhbHVlIC8gKGRvc2UudmFsdWUgKiBkb3Nlc1BlckRheSkpICogKDEgKyByZWZpbGxzKQogICAgcmV0dXJuCiAgICAgIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgdG90YWxEYXlzU3VwcGxpZWQgaXMgbm90IG51bGwgdGhlbgogICAgICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgUXVhbnRpdHkodG90YWxEYXlzU3VwcGxpZWQgLSAxLCAnZGF5JykgXQogICAgICBlbHNlIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgYm91bmRzUGVyaW9kLiJoaWdoIiBpcyBub3QgbnVsbCB0aGVuCiAgICAgICAgSW50ZXJ2YWxbc3RhcnREYXRlLCBkYXRlIGZyb20gZW5kIG9mIGJvdW5kc1BlcmlvZF0KICAgICAgZWxzZQogICAgICAgIG51bGwKCi8qCk5leHQsIGNvbnNpZGVyIHRoZSBNZWRpY2F0aW9uRGlzcGVuc2UgY2FzZToKKiB3aGVuUHJlcGFyZWQ6IFdoZW4gcHJvZHVjdCB3YXMgcHJlcGFyZWQKKiB3aGVuSGFuZGVkT3ZlcjogV2hlbiBwcm9kdWN0IHdhcyBnaXZlbiBvdXQKKiBxdWFudGl0eTogQW1vdW50IGRpc3BlbnNlZAoqIGRheXNTdXBwbHk6IEFtb3VudCBvZiBtZWRpY2F0aW9uIGV4cHJlc3NlZCBhcyBhIHRpbWluZyBhbW91bnQKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmJvdW5kc0R1cmF0aW9uOiB0b3RhbCBkdXJhdGlvbiBvZiB0aGUgcmVwZWF0CiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5ib3VuZHNSYW5nZTogcmFuZ2Ugb2YgZHVyYXRpb25zIG9mIHRoZSByZXBlYXQKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmJvdW5kc1BlcmlvZDogcGVyaW9kIGJvdW5kcyBvZiB0aGUgcmVwZWF0CiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5jb3VudDogbnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuY291bnRNYXg6IG1heGltdW0gbnVtYmVyIG9mIHRpbWVzIHRvIHJlcGVhdAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQuZnJlcXVlbmN5OiBldmVudCBvY2N1cnMgZnJlcXVlbmN5IHRpbWVzIHBlciBwZXJpb2QKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heDogZXZlbnQgb2NjdXJzIHVwIHRvIGZyZXF1ZW5jeU1heCB0aW1lcyBwZXIgcGVyaW9kCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC5wZXJpb2Q6IGV2ZW50IG9jY3VycyBmcmVxdWVuY3kgdGltZXMgcGVyIHBlcmlvZAoqIGRvc2FnZUluc3RydWN0aW9uLnRpbWluZy5yZXBlYXQucGVyaW9kTWF4OiB1cHBlciBsaW1pdCBvZiBwZXJpb2QKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQ6IHBlcmlvZCBkdXJhdGlvbiAocyB8IG1pbiB8IGggfCBkIHwgd2sgfCBtbyB8IGEpCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC50aW1lT2ZEYXk6IHRpbWUgb2YgZGF5IGZvciB0aGUgZXZlbnQgKDAuLiopCiogZG9zYWdlSW5zdHJ1Y3Rpb24udGltaW5nLnJlcGVhdC53aGVuOiBldmVudCB0aW1pbmcgKEhTIHwgV0FLRSB8IEMgfCBDTSB8IENEIHwgQ1YgfCBBQyB8IEFDTS4uLikKKiBkb3NhZ2VJbnN0cnVjdGlvbi50aW1pbmcuY29kZTogQklEIHwgVElEIHwgUUlEIHwgQU0gfCBQTSB8IFFEIHwgUU9ELi4uCiogZG9zYWdlSW5zdHJ1Y3Rpb24uYXNOZWVkZWQKKiBkb3NhZ2VJbnN0cnVjdGlvbi5kb3NlQW5kUmF0ZS5kb3NlUXVhbnRpdHkKKiBkb3NhZ2VJbnN0cnVjdGlvbi5kb3NlQW5kUmF0ZS5kb3NlUmFuZ2UKV2UgaGF2ZSBlZmZlY3RpdmVseSB0aGUgc2FtZSBlbGVtZW50cywgd2l0aCB0aGUgc2FtZSBtZWFuaW5ncywgd2l0aCB0aGUgZXhjZXB0aW9uIHRoYXQgdGhlCmV2ZW50IGlzIGRvY3VtZW50aW5nIGEgc2luZ2xlIGRpc3BlbnNlLCBhbmQgZG9lcyBub3QgY29udGFpbiByZWZpbGwgaW5mb3JtYXRpb24uIEluIGFkZGl0aW9uLAptdWx0aXBsZSBkaXNwZW5zZSBldmVudHMgd291bGQgdHlwaWNhbGx5IGJlIHByZXNlbnQsIGFuZCB0aG9zZSB3b3VsZCBhbGwgaGF2ZSB0byBiZSBjb25zaWRlcmVkCmFzIHBhcnQgb2YgYW4gb3ZlcmFsbCBjYWxjdWxhdGlvbi4gVGhhdCB3aWxsIGJlIGNvbnNpZGVyZWQgd2hlbiB3ZSBjb21iaW5lIHJlc3VsdHMsIGJ1dCBmb3IKdGhpcyBmdW5jdGlvbiwgd2UnbGwgZm9jdXMgb24gY2FsY3VsYXRpbmcgdGhlIGR1cmF0aW9uIG9mIGEgc2luZ2xlIGRpc3BlbnNlLgpXaXRoIGEgTWVkaWNhdGlvbkRpc3BlbnNlLCBkb3NhZ2UgaW5mb3JtYXRpb24gaXMgZXhwZWN0ZWQgdG8gYmUgdGhlIHNhbWUgYXMgdGhlIHJlbGF0ZWQKTWVkaWNhdGlvblJlcXVlc3QsIHNvIGJvdW5kc1BlcmlvZCB3b3VsZCBzdGlsbCBjb3ZlciB0aGUgZW50aXJlIHByZXNjcmlwdGlvbiAoaW5jbHVkaW5nIHJlZmlsbHMpCmFuZCBzbyBjYW5ub3QgYmUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIGludGVydmFsIGNvdmVyZWQgYnkgdGhlIGRpc3BlbnNlLgpJZiB0aGUgZGF5c1N1cHBseSBlbGVtZW50IGlzIHByZXNlbnQsIHRoZW4gdGhlIGR1cmF0aW9uIGluIGRheXMgaXMgc2ltcGx5CiAgICBkYXlzU3VwcGx5Ck5vdGUgc3BlY2lmaWNhbGx5IHRoYXQgd2UgYXJlIG5vdCBjb25zaWRlcmluZyByZWZpbGxzLCBhcyB0aG9zZSB3b3VsZCBiZSBjb3ZlcmVkCmJ5IHN1YnNlcXVlbnQgZGlzcGVuc2UgcmVjb3Jkcy4KSWYgZGF5c1N1cHBsaWVkIGlzIG5vdCBwcmVzZW50LCB0aGVuIGRheXNTdXBwbGllZCBtdXN0IGJlIGNhbGN1bGF0ZWQgYmFzZWQgb24KdGhlIHF1YW50aXR5LCBkb3NhZ2UsIGFuZCBmcmVxdWVuY3k6CiAgICAocXVhbnRpdHkgLyAoZG9zYWdlICogZnJlcXVlbmN5KSkKVGhpcyBjYWxjdWxhdGlvbiByZXN1bHRzIGluIGEgbnVtYmVyIG9mIGRheXMsIHdoaWNoIGNhbiB0aGVuIGJlIHR1cm5lZCBpbnRvIGEKcGVyaW9kIGJ5IGFuY2hvcmluZyB0aGF0IHRvIHRoZSBzdGFydERhdGUsIGFzIGRldGVybWluZWQgYnkgdGhlIGZpcnN0IGF2YWlsYWJsZQp2YWx1ZSBvZiB0aGUgc3RhcnQgb2YgdGhlIGJvdW5kc1BlcmlvZCwgd2hlbkhhbmRlZE92ZXIsIGFuZCB3aGVuUHJlcGFyZWQuCiAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgdG90YWxEYXlzU3VwcGxpZWQgLSAxIGRheV0KKi8KCi8qCkNhbGN1bGF0ZXMgTWVkaWNhdGlvbiBQZXJpb2QgZm9yIGEgZ2l2ZW4gTWVkaWNhdGlvbkRpc3BlbnNlCk1lZGljYXRpb25EaXNwZW5zZSBpbnN0YW5jZXMgcHJvdmlkZWQgdG8gdGhpcyBmdW5jdGlvbiBhcmUgZXhwZWN0ZWQKdG8gY29uZm9ybSB0byB0aGUgW1RPRE86IE1NRU1lZGljYXRpb25EaXNwZW5zZV0oaHR0cDovL2J1aWxkLmZoaXIub3JnL2lnL2NxZnJhbWV3b3JrL29waW9pZC1tbWUtcjQvU3RydWN0dXJlRGVmaW5pdGlvbi1tbWVtZWRpY2F0aW9uZGlzcGVuc2UuaHRtbCkKcHJvZmlsZSwgd2hpY2ggZXhwZWN0czoKKiAxIGFuZCBvbmx5IDEgZG9zYWdlSW5zdHJ1Y3Rpb24sIG11bHRpcGxlIGRvc2FnZUluc3RydWN0aW9uIGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGFuIGVycm9yCiogMSBhbmQgb25seSAxIGRvc2VBbmRSYXRlLCBtdWx0aXBsZSBkb3NlQW5kUmF0ZSBlbGVtZW50cyB3aWxsIHJlc3VsdCBpbiBhbiBlcnJvcgoqIDEgdGltaW5nIHdpdGggMSByZXBlYXQsIG1pc3NpbmcgdGltaW5nIG9yIHJlcGVhdCBlbGVtZW50cyB3aWxsIHJlc3VsdCBpbiBhIG51bGwKKiBmcmVxdWVuY3ksIGZyZXF1ZW5jeU1heCwgZGVmYXVsdGluZyB0byAxCiogcGVyaW9kLCBwZXJpb2RVbml0LCBkZWZhdWx0aW5nIHRvIDEgJ2QnCiogdGltZU9mRGF5CiogZG9zZVF1YW50aXR5IG9yIGRvc2VSYW5nZSwgbWlzc2luZyBkb3NlUXVhbnRpdHkgYW5kIGRvc2VSYW5nZSB3aWxsIHJlc3VsdCBpbiBhIG51bGwKKiB3aGVuSGFuZGVkT3ZlciBvciB3aGVuUHJlcGFyZWQsIGlmIG1pc3NpbmcgYm90aCB3aGVuSGFuZGVkT3ZlciBhbmQgd2hlblByZXBhcmVkIHdpbGwgcmVzdWx0IGluIGEgbnVsbApOb3RlIHRoYXQgTWVkaWNhdGlvbkRpc3BlbnNlIHN0YXR1cyBpcyBub3QgY29uc2lkZXJlZCBieSB0aGlzIGNhbGN1bGF0aW9uLCBhcyB0aGUKbGlzdCBvZiBNZWRpY2F0aW9uRGlzcGVuc2UgaW5zdGFuY2VzIHByb3ZpZGVkIHRvIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGFscmVhZHkgaGF2ZQpjb25zaWRlcmVkIGFwcHJvcHJpYXRlIHN0YXR1c2VzLCBkZXBlbmRpbmcgb24gdGhlIHVzZSBjYXNlLCB0eXBpY2FsbHkgYGNvbXBsZXRlZGAsCmVzcGVjaWFsbHkgc2luY2Ugd2hlbkhhbmRlZE92ZXIgd291bGQgYmUgZXhwZWN0ZWQgdG8gYmUgcHJlc2VudCBmb3IgYSBjb21wbGV0ZWQKTWVkaWNhdGlvbkRpc3BlbnNlLgpOb3RlIGFsc28gdGhhdCB0aGUgZG9zYWdlIGluZm9ybWF0aW9uIHJlY29yZGVkIGluIGEgZGlzcGVuc2UgaXMgZXhwZWN0ZWQgdG8gYmUgYSBjb3B5IG9mIHRoZQpkaXNwZW5zZSBpbmZvcm1hdGlvbiBmcm9tIHRoZSByZWxhdGVkIG1lZGljYXRpb24gcmVxdWVzdC4gQXMgc3VjaCwgdGhlIGJvdW5kc1BlcmlvZCB3b3VsZCBiZSBleHBlY3RlZAp0byBjb3ZlciB0aGUgZW50aXJlIHJhbmdlLCBhbmQgc2hvdWxkIF9ub3RfIGJlIHVzZWQgZm9yIHRpbWluZyBvZiB0aGUgZXZlbnQuClRoZXJlIGlzIGFsc28gYWN0aXZlIGRpc2N1c3Npb24gaW4gdGhlIFBoYXJtYWN5IFdHIGFib3V0IHdoYXQgZGF0ZSBzaG91bGQgYmUgdXNlZCBpZiB3aGVuUHJlcGFyZWQvd2hlbkhhbmRlZE92ZXIgaXMgbm90IHByZXNlbnQuClRoaXMgbWF5IHRha2UgdGhlIGZvcm0gb2YgYW4gIm9yaWdpbmFsIGNyZWF0aW9uIGRhdGUiLCBidXQgbWF5IGFsc28gYmUgYSAic3RhdHVzIGNoYW5nZSBkYXRlIiBmb3IgZGlzcGVuc2UgZXZlbnRzIHRoYXQgYXJlIHVwZGF0aW5nCnN0YXR1cyBvZiBhbiBleGlzdGluZyBkaXNwZW5zZS4gVGhhdCBkaXNjdXNzaW9uIGlzIG9uZ29pbmcsIHNvIHVudGlsIHRoYXQgaXMgcmVzb2x2ZWQsIHRoaXMgbG9naWMgd2lsbCByZXR1cm4KbnVsbCBpZiB3aGVuUHJlcGFyZWQvd2hlbkhhbmRlZE92ZXIgYXJlIG5vdCBhdmFpbGFibGUuCiovCmRlZmluZSBmdW5jdGlvbiBNZWRpY2F0aW9uRGlzcGVuc2VQZXJpb2QoRGlzcGVuc2UgIk1lZGljYXRpb25EaXNwZW5zZSIpOgogIERpc3BlbnNlIEQKICAgIGxldAogICAgICBkb3NhZ2U6IHNpbmdsZXRvbiBmcm9tIEQuZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgIGRvc2VBbmRSYXRlOiBzaW5nbGV0b24gZnJvbSBkb3NhZ2UuZG9zZUFuZFJhdGUsCiAgICAgIHRpbWluZzogZG9zYWdlLnRpbWluZywKICAgICAgZnJlcXVlbmN5OiBDb2FsZXNjZSh0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heCwgdGltaW5nLnJlcGVhdC5mcmVxdWVuY3kpLAogICAgICBwZXJpb2Q6IFF1YW50aXR5KHRpbWluZy5yZXBlYXQucGVyaW9kLCB0aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQpLAogICAgICBkb3NlUmFuZ2U6IGRvc2VBbmRSYXRlLmRvc2UsCiAgICAgIGRvc2VRdWFudGl0eTogZG9zZUFuZFJhdGUuZG9zZSwKICAgICAgZG9zZTogQ29hbGVzY2UoZW5kIG9mIGRvc2VSYW5nZSwgZG9zZVF1YW50aXR5KSwKICAgICAgZGF5c1N1cHBseTogKGNvbnZlcnQgRC5kYXlzU3VwcGx5IHRvIGRheXMpLnZhbHVlLAogICAgICBkb3Nlc1BlckRheTogQ29hbGVzY2UoVG9EYWlseShmcmVxdWVuY3ksIHBlcmlvZCksIENvdW50KHRpbWluZy5yZXBlYXQudGltZU9mRGF5KSwgMS4wKSwKICAgICAgc3RhcnREYXRlOgogICAgICAgIENvYWxlc2NlKAogICAgICAgICAgZGF0ZSBmcm9tIEQud2hlbkhhbmRlZE92ZXIsCiAgICAgICAgICBkYXRlIGZyb20gRC53aGVuUHJlcGFyZWQKICAgICAgICApLAogICAgICB0b3RhbERheXNTdXBwbGllZDogQ29hbGVzY2UoZGF5c1N1cHBseSwgRC5xdWFudGl0eS52YWx1ZSAvIChkb3NlLnZhbHVlICogZG9zZXNQZXJEYXkpKQogICAgcmV0dXJuCiAgICAgIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgdG90YWxEYXlzU3VwcGxpZWQgaXMgbm90IG51bGwgdGhlbgogICAgICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgUXVhbnRpdHkodG90YWxEYXlzU3VwcGxpZWQgLSAxLCAnZGF5JyldCiAgICAgIGVsc2UKICAgICAgICBudWxsCgogLyoKQ2FsY3VsYXRlcyBNZWRpY2F0aW9uIFBlcmlvZCBmb3IgYSBnaXZlbiBNZWRpY2F0aW9uRGlzcGVuc2UKTWVkaWNhdGlvbkRpc3BlbnNlIGluc3RhbmNlcyBwcm92aWRlZCB0byB0aGlzIGZ1bmN0aW9uIGFyZSBleHBlY3RlZAp0byBjb25mb3JtIHRvIHRoZSBbVE9ETzogTU1FTWVkaWNhdGlvbkRpc3BlbnNlXShodHRwOi8vYnVpbGQuZmhpci5vcmcvaWcvY3FmcmFtZXdvcmsvb3Bpb2lkLW1tZS1yNC9TdHJ1Y3R1cmVEZWZpbml0aW9uLW1tZW1lZGljYXRpb25kaXNwZW5zZS5odG1sKQpwcm9maWxlLCB3aGljaCBleHBlY3RzOgoqIDEgYW5kIG9ubHkgMSBkb3NhZ2VJbnN0cnVjdGlvbiwgbXVsdGlwbGUgZG9zYWdlSW5zdHJ1Y3Rpb24gZWxlbWVudHMgd2lsbCByZXN1bHQgaW4gYW4gZXJyb3IKKiAxIGFuZCBvbmx5IDEgZG9zZUFuZFJhdGUsIG11bHRpcGxlIGRvc2VBbmRSYXRlIGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGFuIGVycm9yCiogMSB0aW1pbmcgd2l0aCAxIHJlcGVhdCwgbWlzc2luZyB0aW1pbmcgb3IgcmVwZWF0IGVsZW1lbnRzIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIGZyZXF1ZW5jeSwgZnJlcXVlbmN5TWF4LCBkZWZhdWx0aW5nIHRvIDEKKiBwZXJpb2QsIHBlcmlvZFVuaXQsIGRlZmF1bHRpbmcgdG8gMSAnZCcKKiB0aW1lT2ZEYXkKKiBkb3NlUXVhbnRpdHkgb3IgZG9zZVJhbmdlLCBtaXNzaW5nIGRvc2VRdWFudGl0eSBhbmQgZG9zZVJhbmdlIHdpbGwgcmVzdWx0IGluIGEgbnVsbAoqIHdoZW5IYW5kZWRPdmVyIG9yIHdoZW5QcmVwYXJlZCwgaWYgbWlzc2luZyBib3RoIHdoZW5IYW5kZWRPdmVyIGFuZCB3aGVuUHJlcGFyZWQgd2lsbCByZXN1bHQgaW4gYSBudWxsCk5vdGUgdGhhdCBNZWRpY2F0aW9uRGlzcGVuc2Ugc3RhdHVzIGlzIG5vdCBjb25zaWRlcmVkIGJ5IHRoaXMgY2FsY3VsYXRpb24sIGFzIHRoZQpsaXN0IG9mIE1lZGljYXRpb25EaXNwZW5zZSBpbnN0YW5jZXMgcHJvdmlkZWQgdG8gdGhpcyBmdW5jdGlvbiBzaG91bGQgYWxyZWFkeSBoYXZlCmNvbnNpZGVyZWQgYXBwcm9wcmlhdGUgc3RhdHVzZXMsIGRlcGVuZGluZyBvbiB0aGUgdXNlIGNhc2UsIHR5cGljYWxseSBgY29tcGxldGVkYCwKZXNwZWNpYWxseSBzaW5jZSB3aGVuSGFuZGVkT3ZlciB3b3VsZCBiZSBleHBlY3RlZCB0byBiZSBwcmVzZW50IGZvciBhIGNvbXBsZXRlZApNZWRpY2F0aW9uRGlzcGVuc2UuCk5vdGUgYWxzbyB0aGF0IHRoZSBkb3NhZ2UgaW5mb3JtYXRpb24gcmVjb3JkZWQgaW4gYSBkaXNwZW5zZSBpcyBleHBlY3RlZCB0byBiZSBhIGNvcHkgb2YgdGhlCmRpc3BlbnNlIGluZm9ybWF0aW9uIGZyb20gdGhlIHJlbGF0ZWQgbWVkaWNhdGlvbiByZXF1ZXN0LiBBcyBzdWNoLCB0aGUgYm91bmRzUGVyaW9kIHdvdWxkIGJlIGV4cGVjdGVkCnRvIGNvdmVyIHRoZSBlbnRpcmUgcmFuZ2UsIGFuZCBzaG91bGQgX25vdF8gYmUgdXNlZCBmb3IgdGltaW5nIG9mIHRoZSBldmVudC4KVGhlcmUgaXMgYWxzbyBhY3RpdmUgZGlzY3Vzc2lvbiBpbiB0aGUgUGhhcm1hY3kgV0cgYWJvdXQgd2hhdCBkYXRlIHNob3VsZCBiZSB1c2VkIGlmIHdoZW5QcmVwYXJlZC93aGVuSGFuZGVkT3ZlciBpcyBub3QgcHJlc2VudC4KVGhpcyBtYXkgdGFrZSB0aGUgZm9ybSBvZiBhbiAib3JpZ2luYWwgY3JlYXRpb24gZGF0ZSIsIGJ1dCBtYXkgYWxzbyBiZSBhICJzdGF0dXMgY2hhbmdlIGRhdGUiIGZvciBkaXNwZW5zZSBldmVudHMgdGhhdCBhcmUgdXBkYXRpbmcKc3RhdHVzIG9mIGFuIGV4aXN0aW5nIGRpc3BlbnNlLiBUaGF0IGRpc2N1c3Npb24gaXMgb25nb2luZywgc28gdW50aWwgdGhhdCBpcyByZXNvbHZlZCwgdGhpcyBsb2dpYyB3aWxsIHJldHVybgpudWxsIGlmIHdoZW5QcmVwYXJlZC93aGVuSGFuZGVkT3ZlciBhcmUgbm90IGF2YWlsYWJsZS4KKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBtZWRpY2F0aW9uRGlzcGVuc2VQZXJpb2QoRGlzcGVuc2UgIk1lZGljYXRpb25EaXNwZW5zZSIpOgogIERpc3BlbnNlIEQKICAgIGxldAogICAgICBkb3NhZ2U6IHNpbmdsZXRvbiBmcm9tIEQuZG9zYWdlSW5zdHJ1Y3Rpb24sCiAgICAgIGRvc2VBbmRSYXRlOiBzaW5nbGV0b24gZnJvbSBkb3NhZ2UuZG9zZUFuZFJhdGUsCiAgICAgIHRpbWluZzogZG9zYWdlLnRpbWluZywKICAgICAgZnJlcXVlbmN5OiBDb2FsZXNjZSh0aW1pbmcucmVwZWF0LmZyZXF1ZW5jeU1heCwgdGltaW5nLnJlcGVhdC5mcmVxdWVuY3kpLAogICAgICBwZXJpb2Q6IFF1YW50aXR5KHRpbWluZy5yZXBlYXQucGVyaW9kLCB0aW1pbmcucmVwZWF0LnBlcmlvZFVuaXQpLAogICAgICBkb3NlUmFuZ2U6IGRvc2VBbmRSYXRlLmRvc2UsCiAgICAgIGRvc2VRdWFudGl0eTogZG9zZUFuZFJhdGUuZG9zZSwKICAgICAgZG9zZTogQ29hbGVzY2UoZW5kIG9mIGRvc2VSYW5nZSwgZG9zZVF1YW50aXR5KSwKICAgICAgZGF5c1N1cHBseTogKGNvbnZlcnQgRC5kYXlzU3VwcGx5IHRvIGRheXMpLnZhbHVlLAogICAgICBkb3Nlc1BlckRheTogQ29hbGVzY2UoVG9EYWlseShmcmVxdWVuY3ksIHBlcmlvZCksIENvdW50KHRpbWluZy5yZXBlYXQudGltZU9mRGF5KSwgMS4wKSwKICAgICAgc3RhcnREYXRlOgogICAgICAgIENvYWxlc2NlKAogICAgICAgICAgZGF0ZSBmcm9tIEQud2hlbkhhbmRlZE92ZXIsCiAgICAgICAgICBkYXRlIGZyb20gRC53aGVuUHJlcGFyZWQKICAgICAgICApLAogICAgICB0b3RhbERheXNTdXBwbGllZDogQ29hbGVzY2UoZGF5c1N1cHBseSwgRC5xdWFudGl0eS52YWx1ZSAvIChkb3NlLnZhbHVlICogZG9zZXNQZXJEYXkpKQogICAgcmV0dXJuCiAgICAgIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgdG90YWxEYXlzU3VwcGxpZWQgaXMgbm90IG51bGwgdGhlbgogICAgICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgUXVhbnRpdHkodG90YWxEYXlzU3VwcGxpZWQgLSAxLCAnZGF5JyldCiAgICAgIGVsc2UKICAgICAgICBudWxsCiAKLyoKUmV0dXJucyB0aGUgZXN0YWJsaXNoZWQgdGhlcmFwZXV0aWMgZHVyYXRpb24gZm9yIGEgZ2l2ZW4gbWVkaWNhdGlvbi4KVGhpcyBpcyBsaWtlbHkgbWVhc3VyZSBzcGVjaWZpYywgdGhvdWdoIGNvdWxkIHBvdGVudGlhbGx5IGJlIGVzdGFibGlzaGVkIGZvcgphbnkgZHJ1ZyBhbmQgZGlzdHJpYnV0ZWQgYXMgYSBDb2RlU3lzdGVtIHN1cHBsZW1lbnQuCkRlZmF1bHRpbmcgdG8gMTQgZGF5cyBoZXJlIGZvciBpbGx1c3RyYXRpb24uCiovCmRlZmluZSBmdW5jdGlvbiBUaGVyYXBldXRpY0R1cmF0aW9uKG1lZGljYXRpb24gQ29uY2VwdCk6CiAgMTQgZGF5cwoKIC8qCk5leHQgd2UgY29uc2lkZXIgTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uLiBUaGlzIGRhdGEgdHlwZSBpcyB0eXBpY2FsbHkgdXNlZCB0bwpjYXB0dXJlIHNwZWNpZmljIGFkbWluaXN0cmF0aW9uLCB3aXRoIHRoZSByZWxldmFudFBlcmlvZCBjYXB0dXJpbmcgc3RhcnQgYW5kIHN0b3AKdGltZSBvZiB0aGUgYWRtaW5pc3RyYXRpb24gZXZlbnQ6CiogZWZmZWN0aXZlW3hdOiBTdGFydCBhbmQgZW5kIHRpbWUgb2YgYWRtaW5pc3RyYXRpb24KSG93ZXZlciwgd2hlbiBjYWxjdWxhdGluZyBjdW11bGF0aXZlIG1lZGljYXRpb24gZHVyYXRpb24sIGl0IGlzIHR5cGljYWxseSB0aGUKdGhlcmFwZXV0aWMgcGVyaW9kIG9mIHRoZSBtZWRpY2F0aW9uIHRoYXQgc2hvdWxkIGJlIGNvbnNpZGVyZWQuIEN1cnJlbnRseSBuZWl0aGVyCnRoZSBNZWRpY2F0aW9uIG5vciBNZWRpY2F0aW9uS25vd2xlZGdlIHJlc291cmNlcyBwcm92aWRlIHRoaXMgaW5mb3JtYXRpb24sIHNvCndlIG1vZGVsIGl0IGhlcmUgYXMgYSBmdW5jdGlvbiB0aGF0IGNhbiBwb3RlbnRpYWxseSBiZSBpbXBsZW1lbnRlZCBpbiBhIHZhcmlldHkKb2Ygd2F5cywgaW5jbHVkaW5nIG1lYXN1cmUtc3BlY2lmaWMgdmFsdWVzLCBhcyB3ZWxsIGFzIGRpc3RyaWJ1dGlvbiBhcyBhbiBSeE5vcm0KY29kZSBzeXN0ZW0gc3VwcGxlbWVudC4KSG93ZXZlciBpdCBpcyBvYnRhaW5lZCwgaWYgdGhlcmFwZXV0aWMgZHVyYXRpb24gY2FuIGJlIG9idGFpbmVkLCBhbmQgdGhlIGVmZmVjdGl2ZQpwZXJpb2QgaGFzIGEgc3RhcnQsIHRoZSByZXN1bHQgd2lsbCBiZQogICAgSW50ZXJ2YWxbc3RhcnREYXRlLCBzdGFydERhdGUgKyB0aGVyYXBldXRpY0R1cmF0aW9uIC0gMSBkYXldCk5PVEU6IFRoZXJhcGV1dGljIGR1cmF0aW9uIG5lZWRzIHRvIGJlIGVzdGFibGlzaGVkIGFuZCB1bnRpbCBhIHdheSBpcyBpbXBsZW1lbnRlZCB0bwpkbyB0aGF0IGJhc2VkIG9uIHRoZSBtZWRpY2F0aW9uLCB0aGlzIGxvZ2ljIGlzIGluY29tcGxldGUgYW5kIHNob3VsZCBub3QgYmUgdXNlZC4KKi8KZGVmaW5lIGZ1bmN0aW9uIE1lZGljYXRpb25BZG1pbmlzdHJhdGlvblBlcmlvZChBZG1pbmlzdHJhdGlvbiAiTWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uIik6CiAgQWRtaW5pc3RyYXRpb24gTQogICAgbGV0CiAgICAgIHRoZXJhcGV1dGljRHVyYXRpb246IFRoZXJhcGV1dGljRHVyYXRpb24oQWRtaW5pc3RyYXRpb24ubWVkaWNhdGlvbiksCiAgICAgIHN0YXJ0RGF0ZTogZGF0ZSBmcm9tIHN0YXJ0IG9mIEFkbWluaXN0cmF0aW9uLmVmZmVjdGl2ZQogICAgcmV0dXJuCiAgICAgIGlmIHN0YXJ0RGF0ZSBpcyBub3QgbnVsbCBhbmQgdGhlcmFwZXV0aWNEdXJhdGlvbiBpcyBub3QgbnVsbCB0aGVuCiAgICAgICAgSW50ZXJ2YWxbc3RhcnREYXRlLCBzdGFydERhdGUgKyB0aGVyYXBldXRpY0R1cmF0aW9uIC0gMV0KICAgICAgZWxzZQogICAgICAgIG51bGwKCiAvKgpOZXh0IHdlIGNvbnNpZGVyIE1lZGljYXRpb25BZG1pbmlzdHJhdGlvbi4gVGhpcyBkYXRhIHR5cGUgaXMgdHlwaWNhbGx5IHVzZWQgdG8KY2FwdHVyZSBzcGVjaWZpYyBhZG1pbmlzdHJhdGlvbiwgd2l0aCB0aGUgcmVsZXZhbnRQZXJpb2QgY2FwdHVyaW5nIHN0YXJ0IGFuZCBzdG9wCnRpbWUgb2YgdGhlIGFkbWluaXN0cmF0aW9uIGV2ZW50OgoqIGVmZmVjdGl2ZVt4XTogU3RhcnQgYW5kIGVuZCB0aW1lIG9mIGFkbWluaXN0cmF0aW9uCkhvd2V2ZXIsIHdoZW4gY2FsY3VsYXRpbmcgY3VtdWxhdGl2ZSBtZWRpY2F0aW9uIGR1cmF0aW9uLCBpdCBpcyB0eXBpY2FsbHkgdGhlCnRoZXJhcGV1dGljIHBlcmlvZCBvZiB0aGUgbWVkaWNhdGlvbiB0aGF0IHNob3VsZCBiZSBjb25zaWRlcmVkLiBDdXJyZW50bHkgbmVpdGhlcgp0aGUgTWVkaWNhdGlvbiBub3IgTWVkaWNhdGlvbktub3dsZWRnZSByZXNvdXJjZXMgcHJvdmlkZSB0aGlzIGluZm9ybWF0aW9uLCBzbwp3ZSBtb2RlbCBpdCBoZXJlIGFzIGEgZnVuY3Rpb24gdGhhdCBjYW4gcG90ZW50aWFsbHkgYmUgaW1wbGVtZW50ZWQgaW4gYSB2YXJpZXR5Cm9mIHdheXMsIGluY2x1ZGluZyBtZWFzdXJlLXNwZWNpZmljIHZhbHVlcywgYXMgd2VsbCBhcyBkaXN0cmlidXRpb24gYXMgYW4gUnhOb3JtCmNvZGUgc3lzdGVtIHN1cHBsZW1lbnQuCkhvd2V2ZXIgaXQgaXMgb2J0YWluZWQsIGlmIHRoZXJhcGV1dGljIGR1cmF0aW9uIGNhbiBiZSBvYnRhaW5lZCwgYW5kIHRoZSBlZmZlY3RpdmUKcGVyaW9kIGhhcyBhIHN0YXJ0LCB0aGUgcmVzdWx0IHdpbGwgYmUKICAgIEludGVydmFsW3N0YXJ0RGF0ZSwgc3RhcnREYXRlICsgdGhlcmFwZXV0aWNEdXJhdGlvbiAtIDEgZGF5XQpOT1RFOiBUaGVyYXBldXRpYyBkdXJhdGlvbiBuZWVkcyB0byBiZSBlc3RhYmxpc2hlZCBhbmQgdW50aWwgYSB3YXkgaXMgaW1wbGVtZW50ZWQgdG8KZG8gdGhhdCBiYXNlZCBvbiB0aGUgbWVkaWNhdGlvbiwgdGhpcyBsb2dpYyBpcyBpbmNvbXBsZXRlIGFuZCBzaG91bGQgbm90IGJlIHVzZWQuCiovCmRlZmluZSBmbHVlbnQgZnVuY3Rpb24gbWVkaWNhdGlvbkFkbWluaXN0cmF0aW9uUGVyaW9kKEFkbWluaXN0cmF0aW9uICJNZWRpY2F0aW9uQWRtaW5pc3RyYXRpb24iKToKICBBZG1pbmlzdHJhdGlvbiBNCiAgICBsZXQKICAgICAgdGhlcmFwZXV0aWNEdXJhdGlvbjogVGhlcmFwZXV0aWNEdXJhdGlvbihBZG1pbmlzdHJhdGlvbi5tZWRpY2F0aW9uKSwKICAgICAgc3RhcnREYXRlOiBkYXRlIGZyb20gc3RhcnQgb2YgQWRtaW5pc3RyYXRpb24uZWZmZWN0aXZlCiAgICByZXR1cm4KICAgICAgaWYgc3RhcnREYXRlIGlzIG5vdCBudWxsIGFuZCB0aGVyYXBldXRpY0R1cmF0aW9uIGlzIG5vdCBudWxsIHRoZW4KICAgICAgICBJbnRlcnZhbFtzdGFydERhdGUsIHN0YXJ0RGF0ZSArIHRoZXJhcGV1dGljRHVyYXRpb24gLSAxXQogICAgICBlbHNlCiAgICAgICAgbnVsbAoKLyoKTm93IHRoYXQgd2UgaGF2ZSBmdW5jdGlvbnMgZm9yIGRldGVybWluaW5nIHRoZSBtZWRpY2F0aW9uIHBlcmlvZCBmb3IgaW5kaXZpZHVhbApwcmVzY3JpcHRpb25zLCBhZG1pbmlzdHJhdGlvbnMsIGFuZCBkaXNwZW5zZXMsIHdlIGNhbiBjb21iaW5lIHRob3NlIHVzaW5nCmFuIG92ZXJhbGwgY3VtdWxhdGl2ZSBtZWRpY2F0aW9uIGR1cmF0aW9uIGNhbGN1bGF0aW9uLgpUaGVyZSBhcmUgdHdvIGJyb2FkIGFwcHJvYWNoZXMgdG8gY2FsY3VsYXRpbmcgY3VtdWxhdGl2ZSBkdXJhdGlvbiwgb25lIHRoYXQgX2NvbGxhcHNlc18Kb3ZlcmxhcHBpbmcgaW50ZXJ2YWxzIHNvIHRoYXQgY2FsY3VsYXRpb25zIGFyZSBub3QgZHVwbGljYXRlZCwgYW5kIG9uZSB0aGF0IF9yb2xscyBvdXRfCm92ZXJsYXBwaW5nIGludGVydmFscyBzbyB0aGF0IHRoZSBkdXJhdGlvbnMgYXJlIGxhaWQgZW5kLXRvLWVuZC4KRmlyc3QsIHdlIGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgc2ltcGx5IGNhbGN1bGF0ZXMgQ3VtdWxhdGl2ZUR1cmF0aW9uIG9mIGEgc2V0IG9mCmludGVydmFsczoKKi8KZGVmaW5lIGZ1bmN0aW9uIEN1bXVsYXRpdmVEdXJhdGlvbihJbnRlcnZhbHMgTGlzdDxJbnRlcnZhbDxEYXRlPj4pOgogICBpZiBJbnRlcnZhbHMgaXMgbm90IG51bGwgdGhlbiAoIFN1bSgoY29sbGFwc2UgSW50ZXJ2YWxzIHBlciBkYXkpWAogICAgICAgIHJldHVybiBhbGwoZGlmZmVyZW5jZSBpbiBkYXlzIGJldHdlZW4gc3RhcnQgb2YgWCBhbmQgCiAgICAgICAgICBlbmQgb2YgWAogICAgICAgICkrIDEKICAgICkKICApIAogICAgZWxzZSBudWxsCgogLyoKTm93IHRoYXQgd2UgaGF2ZSBmdW5jdGlvbnMgZm9yIGRldGVybWluaW5nIHRoZSBtZWRpY2F0aW9uIHBlcmlvZCBmb3IgaW5kaXZpZHVhbApwcmVzY3JpcHRpb25zLCBhZG1pbmlzdHJhdGlvbnMsIGFuZCBkaXNwZW5zZXMsIHdlIGNhbiBjb21iaW5lIHRob3NlIHVzaW5nCmFuIG92ZXJhbGwgY3VtdWxhdGl2ZSBtZWRpY2F0aW9uIGR1cmF0aW9uIGNhbGN1bGF0aW9uLgpUaGVyZSBhcmUgdHdvIGJyb2FkIGFwcHJvYWNoZXMgdG8gY2FsY3VsYXRpbmcgY3VtdWxhdGl2ZSBkdXJhdGlvbiwgb25lIHRoYXQgX2NvbGxhcHNlc18Kb3ZlcmxhcHBpbmcgaW50ZXJ2YWxzIHNvIHRoYXQgY2FsY3VsYXRpb25zIGFyZSBub3QgZHVwbGljYXRlZCwgYW5kIG9uZSB0aGF0IF9yb2xscyBvdXRfCm92ZXJsYXBwaW5nIGludGVydmFscyBzbyB0aGF0IHRoZSBkdXJhdGlvbnMgYXJlIGxhaWQgZW5kLXRvLWVuZC4KRmlyc3QsIHdlIGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgc2ltcGx5IGNhbGN1bGF0ZXMgQ3VtdWxhdGl2ZUR1cmF0aW9uIG9mIGEgc2V0IG9mCmludGVydmFsczoKKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBjdW11bGF0aXZlRHVyYXRpb24oSW50ZXJ2YWxzIExpc3Q8SW50ZXJ2YWw8RGF0ZT4+KToKICAgaWYgSW50ZXJ2YWxzIGlzIG5vdCBudWxsIHRoZW4gKCBTdW0oKGNvbGxhcHNlIEludGVydmFscyBwZXIgZGF5KVgKICAgICAgICByZXR1cm4gYWxsKGRpZmZlcmVuY2UgaW4gZGF5cyBiZXR3ZWVuIHN0YXJ0IG9mIFggYW5kIAogICAgICAgICAgZW5kIG9mIFgKICAgICAgICApKyAxCiAgICApCiAgKSAKICAgIGVsc2UgbnVsbAoKIC8qCk5leHQsIHdlIGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgcm9sbHMgb3V0IGludGVydmFsczoKKi8KZGVmaW5lIGZ1bmN0aW9uIFJvbGxvdXRJbnRlcnZhbHMoaW50ZXJ2YWxzIExpc3Q8SW50ZXJ2YWw8RGF0ZT4+KToKIGludGVydmFscyBJIGFnZ3JlZ2F0ZSBhbGwgUiBzdGFydGluZyAoIG51bGwgYXMgTGlzdDxJbnRlcnZhbDxEYXRlPj4pOiBSCiAgICB1bmlvbiAoIHsgSSBYCiAgICAgICAgbGV0IFM6IE1heCh7IAogICAgICAgICAgZW5kIG9mIExhc3QoUikrIDEgZGF5LCBzdGFydCBvZiBYIH0KICAgICAgICApLAogICAgICAgIEU6IFMgKyBRdWFudGl0eShDb2FsZXNjZShkdXJhdGlvbiBpbiBkYXlzIG9mIFgsIDApLCAnZGF5JykKICAgICAgICByZXR1cm4gSW50ZXJ2YWxbUywgRV19CiAgICApCgogIC8qCk5leHQsIHdlIGRlZmluZSBhIGZ1bmN0aW9uIHRoYXQgcm9sbHMgb3V0IGludGVydmFsczoKKi8KZGVmaW5lIGZsdWVudCBmdW5jdGlvbiByb2xsb3V0SW50ZXJ2YWxzKGludGVydmFscyBMaXN0PEludGVydmFsPERhdGU+Pik6CiBpbnRlcnZhbHMgSSBhZ2dyZWdhdGUgYWxsIFIgc3RhcnRpbmcgKCBudWxsIGFzIExpc3Q8SW50ZXJ2YWw8RGF0ZT4+KTogUgogICAgdW5pb24gKCB7IEkgWAogICAgICAgIGxldCBTOiBNYXgoeyAKICAgICAgICAgIGVuZCBvZiBMYXN0KFIpKyAxIGRheSwgc3RhcnQgb2YgWCB9CiAgICAgICAgKSwKICAgICAgICBFOiBTICsgUXVhbnRpdHkoQ29hbGVzY2UoZHVyYXRpb24gaW4gZGF5cyBvZiBYLCAwKSwgJ2RheScpCiAgICAgICAgcmV0dXJuIEludGVydmFsW1MsIEVdfQogICAgKQoKLyoKVGhlbiwgd2UgZGVmaW5lIGEgZnVuY3Rpb24gdGhhdCBhbGxvd3MgdXMgdG8gY2FsY3VsYXRlIGJhc2VkIG9uIHRoZSB2YXJpb3VzIG1lZGljYXRpb24KdHlwZXM6CiovCgpkZWZpbmUgZnVuY3Rpb24gTWVkaWNhdGlvblBlcmlvZCgKICBtZWRpY2F0aW9uIENob2ljZTwiTWVkaWNhdGlvblJlcXVlc3QiLAogICAgIk1lZGljYXRpb25EaXNwZW5zZSIKICA+KToKICBjYXNlCiAgICB3aGVuIG1lZGljYXRpb24gaXMgTWVkaWNhdGlvblJlcXVlc3QgdGhlbiBNZWRpY2F0aW9uUmVxdWVzdFBlcmlvZChtZWRpY2F0aW9uKQogICAgd2hlbiBtZWRpY2F0aW9uIGlzIE1lZGljYXRpb25EaXNwZW5zZSB0aGVuIE1lZGljYXRpb25EaXNwZW5zZVBlcmlvZChtZWRpY2F0aW9uKQogICAgZWxzZSBudWxsCiAgZW5kCgogLyoKVGhlbiwgd2UgZGVmaW5lIGEgZnVuY3Rpb24gdGhhdCBhbGxvd3MgdXMgdG8gY2FsY3VsYXRlIGJhc2VkIG9uIHRoZSB2YXJpb3VzIG1lZGljYXRpb24KdHlwZXM6CiovCgpkZWZpbmUgZmx1ZW50IGZ1bmN0aW9uIG1lZGljYXRpb25QZXJpb2QoCiAgbWVkaWNhdGlvbiBDaG9pY2U8Ik1lZGljYXRpb25SZXF1ZXN0IiwKICAgICJNZWRpY2F0aW9uRGlzcGVuc2UiCiAgPik6CiAgY2FzZQogICAgd2hlbiBtZWRpY2F0aW9uIGlzIE1lZGljYXRpb25SZXF1ZXN0IHRoZW4gbWVkaWNhdGlvbi5tZWRpY2F0aW9uUmVxdWVzdFBlcmlvZCgpCiAgICB3aGVuIG1lZGljYXRpb24gaXMgTWVkaWNhdGlvbkRpc3BlbnNlIHRoZW4gbWVkaWNhdGlvbi5tZWRpY2F0aW9uRGlzcGVuc2VQZXJpb2QoKQogICAgZWxzZSBudWxsCiAgZW5kCgovKgpXZSBjYW4gdGhlbiB1c2UgdGhpcyBmdW5jdGlvbiwgY29tYmluZWQgd2l0aCB0aGUgTWVkaWNhdGlvbkR1cmF0aW9uIGZ1bmN0aW9ucyBhYm92ZQp0byBjYWxjdWxhdGUgQ3VtdWxhdGl2ZSBNZWRpY2F0aW9uIER1cmF0aW9uOgpHZW5lcmFsbHkgc3BlYWtpbmcsIHdlIHdhbnQgdG8gX3JvbGwgb3V0XyBpbnRlcnZhbHMgZnJvbSBkaXNwZW5zZSBhbmQgYWRtaW5pc3RyYXRpb24KZXZlbnRzLCBhbmQgdGhlbiBjb2xsYXBzZSBhY3Jvc3MgdGhhdCByZXN1bHQgYW5kIGludGVydmFscyBmcm9tIHByZXNjcmlwdGlvbnMuCk5vdGUgYWxzbyB0aGF0IHRoZSBzZXBhcmF0aW9uIG9mIG1lZGljYXRpb25zIGJ5IHR5cGUgc2hvdWxkIGFscmVhZHkgYmUgZG9uZQpieSB0aGlzIHN0YWdlIGFzIHdlbGwuCkNhbGN1bGF0aW9ucyB0aGF0IGNvbWJpbmUgZG9zYWdlcyBmcm9tIGRpZmZlcmVudCB0eXBlcyBvZiBtZWRpY2F0aW9ucyAoc3VjaCBhcyBNb3JwaGluZSBNaWxsaWdyYW0gRXF1aXZhbGVudCAoTU1FKQpvciBBdmVyYWdlIE1NRSkgcmVxdWlyZSBmdXJ0aGVyIGNvbnNpZGVyYXRpb24uCiovCgpkZWZpbmUgZnVuY3Rpb24gQ3VtdWxhdGl2ZU1lZGljYXRpb25EdXJhdGlvbigKICBNZWRpY2F0aW9ucyBMaXN0PENob2ljZTwiTWVkaWNhdGlvblJlcXVlc3QiLAogICAgIk1lZGljYXRpb25EaXNwZW5zZSIKICA+Pik6CiAgQ3VtdWxhdGl2ZUR1cmF0aW9uKCgKICAgICAgTWVkaWNhdGlvbnMgTQogICAgICAgIHdoZXJlIE0gaXMgTWVkaWNhdGlvblJlcXVlc3QKICAgICAgICByZXR1cm4gTWVkaWNhdGlvblJlcXVlc3RQZXJpb2QoTSkKICAgICkKICAgICAgdW5pb24gKAogICAgICAgIFJvbGxvdXRJbnRlcnZhbHMoCiAgICAgICAgICBNZWRpY2F0aW9ucyBNCiAgICAgICAgICAgIHdoZXJlIE0gaXMgTWVkaWNhdGlvbkRpc3BlbnNlCiAgICAgICAgICAgIHJldHVybiBNZWRpY2F0aW9uRGlzcGVuc2VQZXJpb2QoTSkKICAgICAgICApCiAgICAgICkKICApCgogLyoKV2UgY2FuIHRoZW4gdXNlIHRoaXMgZnVuY3Rpb24sIGNvbWJpbmVkIHdpdGggdGhlIE1lZGljYXRpb25EdXJhdGlvbiBmdW5jdGlvbnMgYWJvdmUKdG8gY2FsY3VsYXRlIEN1bXVsYXRpdmUgTWVkaWNhdGlvbiBEdXJhdGlvbjoKR2VuZXJhbGx5IHNwZWFraW5nLCB3ZSB3YW50IHRvIF9yb2xsIG91dF8gaW50ZXJ2YWxzIGZyb20gZGlzcGVuc2UgYW5kIGFkbWluaXN0cmF0aW9uCmV2ZW50cywgYW5kIHRoZW4gY29sbGFwc2UgYWNyb3NzIHRoYXQgcmVzdWx0IGFuZCBpbnRlcnZhbHMgZnJvbSBwcmVzY3JpcHRpb25zLgpOb3RlIGFsc28gdGhhdCB0aGUgc2VwYXJhdGlvbiBvZiBtZWRpY2F0aW9ucyBieSB0eXBlIHNob3VsZCBhbHJlYWR5IGJlIGRvbmUKYnkgdGhpcyBzdGFnZSBhcyB3ZWxsLgpDYWxjdWxhdGlvbnMgdGhhdCBjb21iaW5lIGRvc2FnZXMgZnJvbSBkaWZmZXJlbnQgdHlwZXMgb2YgbWVkaWNhdGlvbnMgKHN1Y2ggYXMgTW9ycGhpbmUgTWlsbGlncmFtIEVxdWl2YWxlbnQgKE1NRSkKb3IgQXZlcmFnZSBNTUUpIHJlcXVpcmUgZnVydGhlciBjb25zaWRlcmF0aW9uLgoqLwoKZGVmaW5lIGZsdWVudCBmdW5jdGlvbiBjdW11bGF0aXZlTWVkaWNhdGlvbkR1cmF0aW9uKApNZWRpY2F0aW9ucyBMaXN0PENob2ljZTwiTWVkaWNhdGlvblJlcXVlc3QiLAoiTWVkaWNhdGlvbkRpc3BlbnNlIgo+Pik6CigoCk1lZGljYXRpb25zIE0Kd2hlcmUgTSBpcyBNZWRpY2F0aW9uUmVxdWVzdApyZXR1cm4gTS5tZWRpY2F0aW9uUmVxdWVzdFBlcmlvZCgpCikKdW5pb24gKAooCk1lZGljYXRpb25zIE0Kd2hlcmUgTSBpcyBNZWRpY2F0aW9uRGlzcGVuc2UKcmV0dXJuIE0ubWVkaWNhdGlvbkRpc3BlbnNlUGVyaW9kKCkKKS5yb2xsb3V0SW50ZXJ2YWxzKCkKKQopLmN1bXVsYXRpdmVEdXJhdGlvbigpCiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCi8qIEZ1bmN0aW9ucyBpbiB0aGlzIHJlZ2lvbiBhcmUgY29waWVkIGZyb20gb3Bpb2lkLW1tZS1yNCAgICAgICAgICAgICAqLwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCmRlZmluZSBmdW5jdGlvbiBRdWFudGl0eSh2YWx1ZSBEZWNpbWFsLCB1bml0IFN0cmluZyk6CiAgaWYgdmFsdWUgaXMgbm90IG51bGwgdGhlbgogICAgU3lzdGVtLlF1YW50aXR5IHsgdmFsdWU6IHZhbHVlLCB1bml0OiB1bml0IH0KICBlbHNlCiAgICBudWxs"
  } ]
}